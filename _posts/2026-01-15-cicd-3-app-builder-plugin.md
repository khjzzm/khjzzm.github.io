---
layout: post
title: "[Part 3] App-Builder Plugin ì‹¤ì „ ë¶„ì„ - CI/CD ìë™í™” í”ŒëŸ¬ê·¸ì¸"
tags: [ gradle, kotlin, devops ]
---

> **CI/CD í•™ìŠµ ì‹œë¦¬ì¦ˆ**
> - [Part 1: Jenkins Pipeline + Groovy ê¸°ì´ˆ](/2026/01/cicd-1-jenkins-pipeline-groovy)
> - [Part 2: Gradle Plugin ê°œë°œ](/2026/01/cicd-2-gradle-plugin)
> - **Part 3: App-Builder Plugin ì‹¤ì „ ë¶„ì„** (í˜„ì¬ ê¸€)
>
> **ì‚¬ì „ ì§€ì‹**: Part 1, 2ë¥¼ ë¨¼ì € í•™ìŠµí•˜ë©´ ì´ ë¬¸ì„œë¥¼ ë” ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ë¥¼ ì²˜ìŒ ì ‘í•˜ëŠ” ê°œë°œìë¥¼ ìœ„í•œ í•™ìŠµ ê°€ì´ë“œë‹¤.

## ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì „ì²´ CI/CD íë¦„](#2-ì „ì²´-cicd-íë¦„)
3. [Jenkins ì—°ë™ - Shared Library](#3-jenkins-ì—°ë™---shared-library)
4. [Gradle í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡°](#4-gradle-í”ŒëŸ¬ê·¸ì¸-êµ¬ì¡°)
5. [ë°ì´í„° ëª¨ë¸ - Entity](#5-ë°ì´í„°-ëª¨ë¸---entity)
6. [ëª¨ë“ˆ ê°ì§€ - GetTargetsTask](#6-ëª¨ë“ˆ-ê°ì§€---gettargetstask)
7. [ë¹Œë“œ ì‹¤í–‰ - AppBuilderTask](#7-ë¹Œë“œ-ì‹¤í–‰---appbuildertask)
8. [3ê°€ì§€ Executor](#8-3ê°€ì§€-executor)
9. [í•™ìŠµ ë¡œë“œë§µ](#9-í•™ìŠµ-ë¡œë“œë§µ)
10. [ì „ì²´ íë¦„ ìš”ì•½](#10-ì „ì²´-íë¦„-ìš”ì•½)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### ì´ í”ŒëŸ¬ê·¸ì¸ì€ ë¬´ì—‡ì¸ê°€?

**ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë“¤(order, payment ë“±)ì„ ë¹Œë“œí•˜ê¸° ìœ„í•œ CI/CD ìë™í™” ë„êµ¬**ë‹¤.

```
â”Œâ”€ order í”„ë¡œì íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Jenkinsfile:                 â”‚
â”‚    @Library('app-builder-gradle-plugin') _
â”‚    build()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ ì´ í”ŒëŸ¬ê·¸ì¸ì´ order í”„ë¡œì íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ë¹Œë“œ
          â–¼
â”Œâ”€ ê²°ê³¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ Git íƒœê·¸ ìƒì„±              â”‚
â”‚  â€¢ Docker ì´ë¯¸ì§€ ECR í‘¸ì‹œ     â”‚
â”‚  â€¢ Helm values ì—…ë°ì´íŠ¸       â”‚
â”‚  â€¢ ArgoCD ìë™ ë°°í¬           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê¸°ë³¸ ì •ë³´

- **ì´ë¦„**: App-Builder Gradle Plugin
- **ê¸°ìˆ  ìŠ¤íƒ**: Kotlin, Gradle, Java 21
- **í•µì‹¬ ê¸°ëŠ¥**:
    - Git Tag ê¸°ë°˜ ë²„ì „ ê´€ë¦¬
    - ëª¨ë“ˆë³„ ì¦ë¶„ ë¹Œë“œ ìë™í™”
    - ë‹¤ì¤‘ ì–¸ì–´ ì§€ì› (JAVA, NODE, GO, PYTHON, PHP, NGINX, HELM)
    - GitOps í†µí•© (ArgoCD + Helm values ìë™ ì—…ë°ì´íŠ¸)

### ë©€í‹° ëª¨ë“ˆ í”„ë¡œì íŠ¸ì™€ ì¦ë¶„ ë¹Œë“œ

ì´ í”ŒëŸ¬ê·¸ì¸ì˜ í•µì‹¬ ê¸°ëŠ¥ì€ **ë©€í‹° ëª¨ë“ˆ í”„ë¡œì íŠ¸ì—ì„œ ë³€ê²½ëœ ëª¨ë“ˆë§Œ ì„ íƒì ìœ¼ë¡œ ë¹Œë“œ**í•˜ëŠ” ê²ƒì´ë‹¤.

#### ë©€í‹° ëª¨ë“ˆ í”„ë¡œì íŠ¸ë€?

í•˜ë‚˜ì˜ Git ì €ì¥ì†Œ ì•ˆì— ì—¬ëŸ¬ ê°œì˜ í•˜ìœ„ í”„ë¡œì íŠ¸(ëª¨ë“ˆ)ê°€ ìˆëŠ” êµ¬ì¡°ë‹¤.

```
C:\repo\com.example.msa\order\              â† Git ì €ì¥ì†Œ (ë£¨íŠ¸)
â”œâ”€â”€ settings.gradle.kts                 â† ëª¨ë“ˆ ëª©ë¡ ì •ì˜
â”œâ”€â”€ build.gradle.kts                    â† ë£¨íŠ¸ ë¹Œë“œ ì„¤ì • + í”ŒëŸ¬ê·¸ì¸ ì ìš©
â”œâ”€â”€ Jenkinsfile                         â† CI/CD íŒŒì´í”„ë¼ì¸
â”‚
â”œâ”€â”€ order-api/                            â† ëª¨ë“ˆ 1: API ì„œë²„
â”‚   â”œâ”€â”€ build.gradle.kts
â”‚   â”œâ”€â”€ Dockerfile.app.java             â† app íƒ€ì… (ë°°í¬ ëŒ€ìƒ)
â”‚   â””â”€â”€ src/
â”‚
â”œâ”€â”€ order-batch/                          â† ëª¨ë“ˆ 2: ë°°ì¹˜ ì„œë²„
â”‚   â”œâ”€â”€ build.gradle.kts
â”‚   â”œâ”€â”€ Dockerfile.app.java
â”‚   â””â”€â”€ src/
â”‚
â”œâ”€â”€ order-common/                         â† ëª¨ë“ˆ 3: ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬
â”‚   â”œâ”€â”€ build.gradle.kts
â”‚   â”œâ”€â”€ Dockerfile.lib.java             â† lib íƒ€ì… (ë°°í¬ ì•ˆ í•¨)
â”‚   â””â”€â”€ src/
â”‚
â””â”€â”€ order-client/                         â† ëª¨ë“ˆ 4: ì™¸ë¶€ ì—°ë™ í´ë¼ì´ì–¸íŠ¸
    â”œâ”€â”€ build.gradle.kts
    â”œâ”€â”€ Dockerfile.lib.java
    â””â”€â”€ src/
```

```kotlin
// settings.gradle.kts
rootProject.name = "order"

include("order-api")
include("order-batch")
include("order-common")
include("order-client")
```

#### ì™œ ë³€ê²½ ê°ì§€ê°€ í•„ìš”í•œê°€?

ì „ì²´ ë¹Œë“œëŠ” **ì‹œê°„ê³¼ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„**ë‹¤.

```
â”Œâ”€ ì „ì²´ ë¹Œë“œ (ë¹„íš¨ìœ¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  order-commonë§Œ ìˆ˜ì •í–ˆëŠ”ë°...                           â”‚
â”‚                                                      â”‚
â”‚  âŒ order-api ë¹Œë“œ     (3ë¶„)                           â”‚
â”‚  âŒ order-batch ë¹Œë“œ   (3ë¶„)                           â”‚
â”‚  âŒ order-common ë¹Œë“œ  (1ë¶„)                           â”‚
â”‚  âŒ order-client ë¹Œë“œ  (1ë¶„)                           â”‚
â”‚                                                      â”‚
â”‚  ì´ 8ë¶„ ì†Œìš” (ë¶ˆí•„ìš”í•œ ë¹Œë“œ í¬í•¨)                      â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ì¦ë¶„ ë¹Œë“œ (íš¨ìœ¨ì ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  order-commonë§Œ ìˆ˜ì •í–ˆì„ ë•Œ...                          â”‚
â”‚                                                      â”‚
â”‚  âœ… order-common ë¹Œë“œ  (1ë¶„) â† ì§ì ‘ ë³€ê²½ë¨              â”‚
â”‚  âœ… order-api ë¹Œë“œ     (3ë¶„) â† order-common ì˜ì¡´        â”‚
â”‚  â­ï¸ order-batch ìŠ¤í‚µ          â† order-common ì˜ì¡´ ì—†ìŒ   â”‚
â”‚  â­ï¸ order-client ìŠ¤í‚µ         â† ë³€ê²½ ì—†ìŒ              â”‚
â”‚                                                      â”‚
â”‚  ì´ 4ë¶„ ì†Œìš” (í•„ìš”í•œ ê²ƒë§Œ ë¹Œë“œ)                        â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë³€ê²½ ê°ì§€ ë¡œì§

í”ŒëŸ¬ê·¸ì¸ì´ ë³€ê²½ì„ ê°ì§€í•˜ëŠ” ë°©ë²•:

```
â”Œâ”€ 1ë‹¨ê³„: Git diffë¡œ ë³€ê²½ëœ íŒŒì¼ í™•ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  $ git diff --name-only HEAD~1 HEAD                  â”‚
â”‚                                                      â”‚
â”‚  ê²°ê³¼:                                               â”‚
â”‚    order-common/src/main/java/Utils.java               â”‚
â”‚    order-common/build.gradle.kts                       â”‚
â”‚                                                      â”‚
â”‚  â†’ order-common ëª¨ë“ˆì—ì„œ ë³€ê²½ ë°œìƒ!                     â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€ 2ë‹¨ê³„: ì˜ì¡´ì„± ë¶„ì„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  order-api/build.gradle.kts:                           â”‚
â”‚    dependencies {                                    â”‚
â”‚      implementation(project(":order-common"))  â† ì˜ì¡´! â”‚
â”‚    }                                                 â”‚
â”‚                                                      â”‚
â”‚  order-batch/build.gradle.kts:                         â”‚
â”‚    dependencies {                                    â”‚
â”‚      // order-common ì˜ì¡´ ì—†ìŒ                         â”‚
â”‚    }                                                 â”‚
â”‚                                                      â”‚
â”‚  â†’ order-commonì´ ë³€ê²½ë˜ë©´ order-apië„ ë¹Œë“œ í•„ìš”!         â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€ 3ë‹¨ê³„: ë¹Œë“œ ëŒ€ìƒ ê²°ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  modules-data.json:                                  â”‚
â”‚  {                                                   â”‚
â”‚    "order-api":    { "changed": true  },  â† ë¹Œë“œ!     â”‚
â”‚    "order-batch":  { "changed": false },  â† ìŠ¤í‚µ      â”‚
â”‚    "order-common": { "changed": true  },  â† ë¹Œë“œ!     â”‚
â”‚    "order-client": { "changed": false }   â† ìŠ¤í‚µ      â”‚
â”‚  }                                                   â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì˜ì¡´ì„± ì „íŒŒ ê·œì¹™

```
order-common (lib) ë³€ê²½ë¨
      â”‚
      â”‚ ì˜ì¡´ì„± ì „íŒŒ
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  order-apiê°€ order-commonì„ ì˜ì¡´                         â”‚
â”‚    â†’ order-apië„ changed: true                        â”‚
â”‚                                                      â”‚
â”‚  order-batchëŠ” order-commonì„ ì˜ì¡´í•˜ì§€ ì•ŠìŒ               â”‚
â”‚    â†’ order-batchëŠ” changed: false (ìŠ¤í‚µ)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì‹¤ì œ ë¹Œë“œ íë¦„ ì˜ˆì‹œ

```
ê°œë°œìê°€ order-common/src/Utils.java ìˆ˜ì • í›„ push
                    â”‚
                    â–¼
â”Œâ”€ gradle GetTargets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  1. Git diff ì‹¤í–‰ â†’ order-common ë³€ê²½ ê°ì§€             â”‚
â”‚  2. ì˜ì¡´ì„± ë¶„ì„ â†’ order-apiê°€ order-common ì˜ì¡´          â”‚
â”‚  3. modules-data.json ìƒì„±:                          â”‚
â”‚     - order-common: changed=true, type=lib            â”‚
â”‚     - order-api: changed=true, type=app               â”‚
â”‚     - order-batch: changed=false                      â”‚
â”‚     - order-client: changed=false                     â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€ Jenkins Pipeline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  Stage 1: [JAVA] order-common                          â”‚
â”‚    â””â”€ gradle AppBuilder -PtargetModule=order-common   â”‚
â”‚       â””â”€ libì´ë¯€ë¡œ Docker ë¹Œë“œë§Œ (ECR í‘¸ì‹œ ì•ˆ í•¨)    â”‚
â”‚                                                      â”‚
â”‚  Stage 2: [JAVA] order-api                             â”‚
â”‚    â””â”€ gradle AppBuilder -PtargetModule=order-api      â”‚
â”‚       â””â”€ appì´ë¯€ë¡œ Docker ë¹Œë“œ + ECR í‘¸ì‹œ + Helm    â”‚
â”‚                                                      â”‚
â”‚  Stage 3: [JAVA] order-batch â­ï¸ SKIPPED                â”‚
â”‚    â””â”€ changed=falseì´ë¯€ë¡œ ìŠ¤í‚µ                       â”‚
â”‚                                                      â”‚
â”‚  Stage 4: [JAVA] order-client â­ï¸ SKIPPED               â”‚
â”‚    â””â”€ changed=falseì´ë¯€ë¡œ ìŠ¤í‚µ                       â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ëª¨ë“ˆ íƒ€ì… (app vs lib)

| íƒ€ì…      | Dockerfile         | ì„¤ëª…                | ë¹Œë“œ ê²°ê³¼                   |
|---------|--------------------|-------------------|-------------------------|
| **app** | `Dockerfile.app.*` | ë°°í¬ ê°€ëŠ¥í•œ ì• í”Œë¦¬ì¼€ì´ì…˜     | ECR í‘¸ì‹œ + Helm ì—…ë°ì´íŠ¸      |
| **lib** | `Dockerfile.lib.*` | ë¼ì´ë¸ŒëŸ¬ë¦¬ (ë‹¤ë¥¸ ëª¨ë“ˆì´ ì˜ì¡´) | Docker ë¹Œë“œë§Œ (ECR í‘¸ì‹œ ì•ˆ í•¨) |

```
order-api/Dockerfile.app.java     â†’ type: "app" â†’ ECR í‘¸ì‹œ O, Helm O
order-common/Dockerfile.lib.java  â†’ type: "lib" â†’ ECR í‘¸ì‹œ X, Helm X
```

### í”ŒëŸ¬ê·¸ì¸ ì •ë³´

| í•­ëª©            | ê°’                                               |
|---------------|-------------------------------------------------|
| **Plugin ID** | `com.example.plugins.app-builder-gradle-plugin` |
| **Version**   | `1.0.0` (ë˜ëŠ” `1.0.0-SNAPSHOT`)                   |
| **êµ¬í˜„ í´ë˜ìŠ¤**    | `com.example.plugins.gradle.AppBuilderPlugin`   |

### Plugin vs Library ì°¨ì´

ì´ í”„ë¡œì íŠ¸ëŠ” **ë‘ ê°€ì§€ ì»´í¬ë„ŒíŠ¸**ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤:

| êµ¬ë¶„        | Jenkins Shared Library | Gradle Plugin           |
|-----------|------------------------|-------------------------|
| **ìš©ë„**    | Jenkins íŒŒì´í”„ë¼ì¸ ì½”ë“œ ê³µìœ     | Gradle ë¹Œë“œ ë¡œì§ í™•ì¥         |
| **ì–¸ì–´**    | Groovy                 | Kotlin                  |
| **í˜¸ì¶œ ë°©ë²•** | `@Library('...') _`    | `plugins { id("...") }` |
| **ìœ„ì¹˜**    | `vars/build.groovy`    | `AppBuilderPlugin.kt`   |

```
app-builder-plugin/
â”œâ”€â”€ app-builder-gradle-plugin/          â† Gradle Plugin (Kotlin)
â”‚   â””â”€â”€ src/main/kotlin/.../
â”‚       â””â”€â”€ AppBuilderPlugin.kt
â”‚
â””â”€â”€ app-builder-gradle-plugin-pipeline/ â† Jenkins Shared Library (Groovy)
    â””â”€â”€ vars/
        â””â”€â”€ build.groovy
```

**ì‹¤ì œ í˜¸ì¶œ íë¦„:**

```
â”Œâ”€ order/Jenkinsfile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @Library('app-builder-gradle-plugin') _              â”‚
â”‚  build()                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ â‘  Jenkins Shared Library í˜¸ì¶œ
         â–¼
â”Œâ”€ vars/build.groovy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  def call() {                                         â”‚
â”‚      sh "gradle GetTargets"   â† Gradle Plugin í˜¸ì¶œ    â”‚
â”‚      sh "gradle AppBuilder"   â† Gradle Plugin í˜¸ì¶œ    â”‚
â”‚  }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ â‘¡ Gradle Plugin ì‹¤í–‰
         â–¼
â”Œâ”€ AppBuilderPlugin.kt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GetTargetsTask, AppBuilderTask ì‹¤í–‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìš”ì•½:** `@Library`ë¡œ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ **Jenkins Shared Library**ì´ê³ , ì´ Libraryê°€ ë‚´ë¶€ì—ì„œ **Gradle Plugin**ì„ í˜¸ì¶œí•œë‹¤. ì‚¬ìš©ìëŠ” Libraryë§Œ í˜¸ì¶œí•˜ë©´ ëœë‹¤.

---

## 2. ì „ì²´ CI/CD íë¦„

### íŠ¸ë¦¬ê±° íë¦„ (Git Push â†’ Jenkins ì‹¤í–‰)

```
â”Œâ”€ ê°œë°œì â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  git push origin develop                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€ GitHub â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì½”ë“œ ìˆ˜ì‹  â†’ Webhook ë°œì†¡ (Jenkinsì— ì•Œë¦¼)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ POST /github-webhook/
         â–¼
â”Œâ”€ Jenkins â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘  Webhook ìˆ˜ì‹                                           â”‚
â”‚  â‘¡ í•´ë‹¹ í”„ë¡œì íŠ¸ ì†ŒìŠ¤ checkout (git clone/pull)           â”‚
â”‚  â‘¢ Jenkinsfile ì½ê¸°                                      â”‚
â”‚  â‘£ @Library('app-builder-gradle-plugin') ë¡œë“œ            â”‚
â”‚  â‘¤ build() ì‹¤í–‰                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ë‹¨ê³„ | ì£¼ì²´          | í•˜ëŠ” ì¼                                |
|----|-------------|-------------------------------------|
| 1  | **GitHub**  | Webhookìœ¼ë¡œ Jenkinsì— "push ì´ë²¤íŠ¸ ë°œìƒ" ì•Œë¦¼ |
| 2  | **Jenkins** | ì†ŒìŠ¤ ì½”ë“œ pull + Jenkinsfile ì½ê¸°         |
| 3  | **Jenkins** | Shared Library ë¡œë“œ + `build()` ì‹¤í–‰    |

**ì°¸ê³ :** GitHubì´ Jenkinsfileì„ ì§ì ‘ ì‹¤í–‰í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, GitHubì€ "ë³€ê²½ëë‹¤"ê³  ì•Œë ¤ì£¼ê¸°ë§Œ í•˜ê³ , **Jenkinsê°€ ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì™€ì„œ Jenkinsfileì„ ì½ê³  ì‹¤í–‰**í•œë‹¤.

### í° ê·¸ë¦¼

```
â”Œâ”€ ì‚¬ìš©ì í”„ë¡œì íŠ¸ (order, payment ë“±) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  Jenkinsfile:                                                    â”‚
â”‚    @Library('app-builder-gradle-plugin') _                       â”‚
â”‚    build()                                                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€ Jenkins Pipeline (build.groovy) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  Stage 1: ë³€ê²½ ê°ì§€                                               â”‚
â”‚    â””â”€ gradle GetTargets                                          â”‚
â”‚          â””â”€ ëª¨ë“ˆ ë°œê²¬, ë³€ê²½ ê°ì§€, modules-data.json ìƒì„±          â”‚
â”‚                                                                  â”‚
â”‚  Stage 2~N: ëª¨ë“ˆë³„ ë¹Œë“œ                                           â”‚
â”‚    â””â”€ gradle AppBuilder -PtargetModule={module}                  â”‚
â”‚          â”œâ”€ ë²„ì „ ê³„ì‚° + Git íƒœê·¸ ìƒì„±                             â”‚
â”‚          â”œâ”€ Docker ì´ë¯¸ì§€ ë¹Œë“œ + ECR í‘¸ì‹œ                         â”‚
â”‚          â””â”€ Helm values ì—…ë°ì´íŠ¸                                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       ArgoCD ìë™ ë°°í¬
```

### ìƒì„¸ íë¦„

```
Jenkins Pipeline
      â”‚
      â”œâ”€ 1. gradle GetTargets
      â”‚      â””â”€ DetectorExecutor
      â”‚           â”œâ”€ settings.gradle íŒŒì‹± â†’ ëª¨ë“ˆ ëª©ë¡
      â”‚           â”œâ”€ Dockerfile í™•ì¸ â†’ íƒ€ì…(app/lib)
      â”‚           â”œâ”€ Git diff â†’ ë³€ê²½ëœ ëª¨ë“ˆ ê°ì§€
      â”‚           â””â”€ modules-data.json ìƒì„±
      â”‚
      â”œâ”€ 2. modules-data.jsonì—ì„œ changed=trueì¸ ëª¨ë“ˆ ì¶”ì¶œ
      â”‚
      â””â”€ 3. ê° ëª¨ë“ˆë³„ ë°˜ë³µ:
           â””â”€ gradle AppBuilder -PtargetModule={module}
                  â””â”€ AppBuilderExecutor
                       â”œâ”€ VersionExecutor (ë²„ì „ ê³„ì‚°, Git íƒœê·¸)
                       â”œâ”€ BuildExecutor (Docker ë¹Œë“œ, ECR í‘¸ì‹œ)
                       â””â”€ HelmExecutor (Helm ì—…ë°ì´íŠ¸, appë§Œ)
                                â”‚
                                â–¼
                         ArgoCD ìë™ ë°°í¬
```

---

## 3. Jenkins ì—°ë™ - Shared Library

### ë‘ ê°œì˜ ì§„ì…ì 

ì´ í”„ë¡œì íŠ¸ëŠ” **ë‘ ê°œì˜ ì§„ì…ì **ì´ ìˆë‹¤:

| êµ¬ë¶„          | ì§„ì…ì                     | íŒŒì¼ ìœ„ì¹˜                                                   |
|-------------|------------------------|---------------------------------------------------------|
| **Jenkins** | `@Library` â†’ `build()` | `app-builder-gradle-plugin-pipeline/vars/build.groovy`  |
| **Gradle**  | `AppBuilderPlugin.kt`  | `app-builder-gradle-plugin/src/.../AppBuilderPlugin.kt` |

```
@Library('app-builder-gradle-plugin') _
build()
   â”‚
   â–¼
build.groovy (Jenkins Shared Library)
   â”‚
   â”‚  ë‚´ë¶€ì—ì„œ Gradle íƒœìŠ¤í¬ í˜¸ì¶œ:
   â”‚
   â”œâ”€ gradle GetTargets    â†’ GetTargetsTask.kt
   â”‚
   â””â”€ gradle AppBuilder    â†’ AppBuilderTask.kt
```

### ì‚¬ìš©ì í”„ë¡œì íŠ¸ì—ì„œì˜ ì‚¬ìš©ë²•

**Jenkinsfile** (ê¸°ë³¸):

```groovy
@Library('app-builder-gradle-plugin') _

build()
```

**Jenkinsfile** (ì„¤ì • ì˜¤ë²„ë¼ì´ë“œ):

```groovy
@Library('app-builder-gradle-plugin') _

build(
        logLevel: 'debug',
        skipStages: '1,3',
        appBuilderConfig: [
                workspace: '/custom/workspace'
        ]
)
```

### build.groovy ìƒì„¸ ë¶„ì„

**íŒŒì¼**: `app-builder-gradle-plugin-pipeline/vars/build.groovy`

ì´ íŒŒì¼ì€ Jenkins Shared Libraryì˜ **ì§„ì…ì **ìœ¼ë¡œ, ì „ì²´ CI/CD íŒŒì´í”„ë¼ì¸ì„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•œë‹¤.

#### ì „ì²´ êµ¬ì¡°

```groovy
def call(Map args = [:]) {
    // 1. Jenkins ë¹Œë“œ íŒŒë¼ë¯¸í„° ì •ì˜
    generateBuildParameters()

    // 2. ì„¤ì •ê°’ ìƒì„± (args + Jenkins params ë³‘í•©)
    def config = generateConfig(args, params)

    // 3. ë¡œê¹…: ì‹¤í–‰ì, ì„¤ì • ì¶œë ¥
    echo "ğŸ‘¨â€ğŸ’¼ì‹¤í–‰ì: ${getUser()}"
    echo "âš™ï¸ì„¤ì •: ${config}"

    // 4. Pipeline ì‹¤í–‰
    node('buildkit') {
        checkout scm

        ansiColor('xterm') {
            withCredentials([...]) {
                def buildData = [:]

                // Stage 1: ë³€ê²½ ê°ì§€
                stage("ğŸ” ë³€ê²½ ê°ì§€") { ... }

                // Stage 2~N: ëª¨ë“ˆë³„ ë¹Œë“œ
                buildData.modules.each { name, module ->
                    stage("[${module.language}] ${module.name}") { ... }
                }
            }
        }
    }
}
```

#### ë°ì´í„° íë¦„

```
â”Œâ”€ Jenkinsfile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  build(logLevel: 'debug', appBuilderConfig: [...])      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ args
          â–¼
â”Œâ”€ generateConfig() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  ì…ë ¥:                                                  â”‚
â”‚    - args (Jenkinsfileì—ì„œ ì „ë‹¬)                        â”‚
â”‚    - params (Jenkins UI ë¹Œë“œ íŒŒë¼ë¯¸í„°)                  â”‚
â”‚                                                         â”‚
â”‚  ì¶œë ¥ (config):                                         â”‚
â”‚    {                                                    â”‚
â”‚      logLevel: 'debug',                                 â”‚
â”‚      skipStages: [1, 3],                               â”‚
â”‚      appBuilderConfig: {                               â”‚
â”‚        appBuilderPath: '/path/to/plugin',              â”‚
â”‚        workspace: '/workspace/project'                  â”‚
â”‚      }                                                  â”‚
â”‚    }                                                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ config
          â–¼
â”Œâ”€ getTargetsTask() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  ì‹¤í–‰: gradle GetTargets                                â”‚
â”‚                                                         â”‚
â”‚  ì¶œë ¥ (buildData):                                      â”‚
â”‚    {                                                    â”‚
â”‚      commit: { repo, branch, author, commitMessage },   â”‚
â”‚      modules: {                                         â”‚
â”‚        "order-api": { index, name, language, type,     â”‚
â”‚                       changed, version, status },       â”‚
â”‚        "order-common": { ... }                          â”‚
â”‚      }                                                  â”‚
â”‚    }                                                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ buildData
          â–¼
â”Œâ”€ modules.each â†’ appBuilderTask() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  ê° ëª¨ë“ˆë³„ë¡œ ë°˜ë³µ:                                       â”‚
â”‚    - isSkipped() ì²´í¬ â†’ ìŠ¤í‚µ or ë¹Œë“œ                    â”‚
â”‚    - gradle AppBuilder -PtargetModule={module}          â”‚
â”‚    - ê²°ê³¼: version, status ì—…ë°ì´íŠ¸                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í•µì‹¬ í•¨ìˆ˜ ìƒì„¸

##### 1. generateBuildParameters()

Jenkins UIì—ì„œ ì„ íƒí•  ìˆ˜ ìˆëŠ” ë¹Œë“œ íŒŒë¼ë¯¸í„° ì •ì˜:

```groovy
def generateBuildParameters() {
    return properties([
            parameters([
                    choice(
                            name: 'LOG_LEVEL',
                            choices: ['warn', 'debug', 'info', 'error'],
                            description: 'Gradle ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ì˜ ë¡œê·¸ ë ˆë²¨'
                    ),
                    string(
                            name: 'SKIP_STAGES',
                            defaultValue: '',
                            description: 'ìŠ¤í‚µí•  ìŠ¤í…Œì´ì§€ ë²ˆí˜¸ (ì˜ˆ: 1,3,5)'
                    )
            ])
    ])
}
```

```
â”Œâ”€ Jenkins UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  Build with Parameters                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚                                                         â”‚
â”‚  LOG_LEVEL: [warn â–¼]                                   â”‚
â”‚    - warn (ê¸°ë³¸)                                        â”‚
â”‚    - debug                                              â”‚
â”‚    - info                                               â”‚
â”‚    - error                                              â”‚
â”‚                                                         â”‚
â”‚  SKIP_STAGES: [___________]                            â”‚
â”‚    ì˜ˆ: "1,3" ì…ë ¥ ì‹œ 1ë²ˆ, 3ë²ˆ ëª¨ë“ˆ ìŠ¤í‚µ                  â”‚
â”‚                                                         â”‚
â”‚  [Build] ë²„íŠ¼                                           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 2. generateConfig()

ì„¤ì • ìš°ì„ ìˆœìœ„ì™€ ë³‘í•© ë¡œì§:

```groovy
def generateConfig(Map args, Map parameters) {
    // 1. logLevel ìš°ì„ ìˆœìœ„: args > Jenkins params > ê¸°ë³¸ê°’
    def logLevel = (args.logLevel ?: parameters.LOG_LEVEL ?: "warn").toLowerCase()

    // 2. skipStages íŒŒì‹±
    def strSkipStages = args.skipStages ?: parameters.SKIP_STAGES ?: ""
    def skipStages = parseSkipStages(strSkipStages)

    // 3. appBuilderConfig ì²˜ë¦¬
    def appBuilderConfig = args.appBuilderConfig ?: [:]

    // 4. appBuilderConfig ê°’ì„ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì • (Gradleì—ì„œ ì‚¬ìš©)
    appBuilderConfig.forEach { key, value ->
        if (key == "workspace") {
            env.APP_BUILDER_WORKSPACE = value  // íŠ¹ìˆ˜ ì²˜ë¦¬
        } else {
            env[camelToSnake(key)] = value     // ecrRegistry â†’ ECR_REGISTRY
        }
    }

    return [
            logLevel        : logLevel,
            skipStages      : skipStages,
            appBuilderConfig: appBuilderConfig
    ]
}
```

**ì„¤ì • ìš°ì„ ìˆœìœ„:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì„¤ì • ìš°ì„ ìˆœìœ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1ìˆœìœ„: Jenkinsfile args                                â”‚
â”‚         build(logLevel: 'debug')                       â”‚
â”‚              â”‚                                          â”‚
â”‚              â–¼                                          â”‚
â”‚  2ìˆœìœ„: Jenkins UI íŒŒë¼ë¯¸í„°                              â”‚
â”‚         LOG_LEVEL ì„ íƒ                                  â”‚
â”‚              â”‚                                          â”‚
â”‚              â–¼                                          â”‚
â”‚  3ìˆœìœ„: ê¸°ë³¸ê°’                                           â”‚
â”‚         'warn'                                          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 3. getTargetsTask()

ë³€ê²½ ê°ì§€ Gradle Task ì‹¤í–‰:

```groovy
def getTargetsTask(Map config) {
    // Gradle GetTargets íƒœìŠ¤í¬ ì‹¤í–‰
    sh """
    gradle -p ${config.appBuilderConfig.appBuilderPath} \
           GetTargets \
           --no-daemon \
           --stacktrace \
           --${config.logLevel}
    """

    // ê²°ê³¼ JSON íŒŒì¼ ì½ê¸°
    def jsonContent = sh(
            script: "cat ${config.appBuilderConfig.appBuilderPath}/build/app-builder/modules-data.json",
            returnStdout: true
    ).trim()

    // JSON â†’ Map ë³€í™˜
    def moduleDataMap = readJSON text: jsonContent

    return moduleDataMap
}
```

**ì‹¤í–‰ ëª…ë ¹ì–´ ì˜ˆì‹œ:**

```bash
gradle -p /workspace/app-builder-plugin GetTargets --no-daemon --stacktrace --debug
```

##### 4. isSkipped()

ìŠ¤í‚µ ì—¬ë¶€ íŒë‹¨:

```groovy
def isSkipped(Map config, Map module) {
    // ì¡°ê±´ 1: ë³€ê²½ë˜ì§€ ì•Šì€ ëª¨ë“ˆ â†’ ìë™ ìŠ¤í‚µ
    // ì¡°ê±´ 2: ìˆ˜ë™ ìŠ¤í‚µ ëª©ë¡ì— í¬í•¨ â†’ ìˆ˜ë™ ìŠ¤í‚µ
    return !module.changed || config.skipStages.contains(module.index + 1 as int)
}
```

```
â”Œâ”€ ìŠ¤í‚µ íŒë‹¨ ë¡œì§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  module.changed = false?                                â”‚
â”‚        â”‚                                                â”‚
â”‚        â”œâ”€ YES â†’ â­ï¸ ìë™ ìŠ¤í‚µ (ë³€ê²½ ì—†ìŒ)                 â”‚
â”‚        â”‚                                                â”‚
â”‚        â””â”€ NO (ë³€ê²½ë¨) â†’ skipStagesì— í¬í•¨?              â”‚
â”‚                              â”‚                          â”‚
â”‚                              â”œâ”€ YES â†’ â­ï¸ ìˆ˜ë™ ìŠ¤í‚µ      â”‚
â”‚                              â”‚                          â”‚
â”‚                              â””â”€ NO â†’ âœ… ë¹Œë“œ ì‹¤í–‰       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 5. appBuilderTask()

ëª¨ë“ˆë³„ ë¹Œë“œ ì‹¤í–‰:

```groovy
def appBuilderTask(Map config, String moduleKey, Map module) {
    // Gradle AppBuilder íƒœìŠ¤í¬ ì‹¤í–‰
    sh """
    gradle -p ${config.appBuilderConfig.appBuilderPath} \
           AppBuilder \
           -PtargetModule=${module.name} \
           --no-daemon \
           --stacktrace \
           --${config.logLevel}
    """

    // ì—…ë°ì´íŠ¸ëœ ëª¨ë“ˆ ì •ë³´ ì½ê¸°
    def jsonContent = sh(
            script: "cat ${config.appBuilderConfig.appBuilderPath}/build/app-builder/modules-data.json",
            returnStdout: true
    ).trim()

    def moduleDataMap = readJSON text: jsonContent
    def result = moduleDataMap?.modules?.get(moduleKey)

    return result  // { version: "1.2.3", status: "SUCCESS" }
}
```

**ì‹¤í–‰ ëª…ë ¹ì–´ ì˜ˆì‹œ:**

```bash
gradle -p /workspace/app-builder-plugin AppBuilder -PtargetModule=order-api --no-daemon --stacktrace --debug
```

##### 6. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤

```groovy
// camelCase â†’ SNAKE_CASE ë³€í™˜
def camelToSnake(String camelCase) {
    return camelCase.replaceAll('([a-z])([A-Z]+)', '$1_$2').toUpperCase()
}
// ì˜ˆ: ecrRegistry â†’ ECR_REGISTRY
//     helmValuesRepo â†’ HELM_VALUES_REPO

// ë¹Œë“œ ì‹¤í–‰ì ì¡°íšŒ
def getUser() {
    def BuildCauses = currentBuild.getBuildCauses('hudson.model.Cause$UserIdCause')
    if (BuildCauses) {
        return BuildCauses.userName  // ìˆ˜ë™ ì‹¤í–‰ ì‹œ ì‚¬ìš©ìëª…
    } else {
        return "Push event"          // Webhook íŠ¸ë¦¬ê±° ì‹œ
    }
}

// Stage ìŠ¤í‚µ ë§ˆí‚¹ (Jenkins UIì— SKIPPEDë¡œ í‘œì‹œ)
def skipStage(String stageName) {
    script {
        org.jenkinsci.plugins.pipeline.modeldefinition.Utils.markStageSkippedForConditional(stageName)
    }
}
```

#### íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì˜ˆì‹œ

```
â”Œâ”€ Jenkins Console Output â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  ğŸ‘¨â€ğŸ’¼ì‹¤í–‰ì: hong.gildong                                â”‚
â”‚  âš™ï¸ì„¤ì •(Jenkins): {                                     â”‚
â”‚      logLevel: debug                                    â”‚
â”‚      skipStages: []                                     â”‚
â”‚  }                                                      â”‚
â”‚  âš™ï¸ì„¤ì •(AppBuilder DSL Override): { ... }               â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Stage: ğŸ” ë³€ê²½ ê°ì§€                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ“‹Git ì •ë³´: {                                          â”‚
â”‚     repo: order                                         â”‚
â”‚     branch: develop                                     â”‚
â”‚     author: hong.gildong                                â”‚
â”‚     message: feat: ì£¼ë¬¸ API ê°œì„                         â”‚
â”‚  }                                                      â”‚
â”‚  ğŸ“¦ëŒ€ìƒ                                                 â”‚
â”‚      â­• order-api                                       â”‚
â”‚      âŒ order-batch                                     â”‚
â”‚      â­• order-common                                    â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Stage: [JAVA] order-common                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ“¦ëª¨ë“ˆ: { name: order-common, language: JAVA, type: lib }
â”‚  ğŸ› ï¸ê²°ê³¼: { status: SUCCESS, version: null â†’ 1.0.1-SNAPSHOT }
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Stage: [JAVA] order-api                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ“¦ëª¨ë“ˆ: { name: order-api, language: JAVA, type: app } â”‚
â”‚  ğŸ› ï¸ê²°ê³¼: { status: SUCCESS, version: null â†’ 1.2.3-beta }â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Stage: [JAVA] order-batch â­ï¸ SKIPPED                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ“¦ëª¨ë“ˆ: { name: order-batch, language: JAVA, type: app }
â”‚  ğŸ› ï¸ê²°ê³¼: { status: SKIPPED }                            â”‚
â”‚                                                         â”‚
â”‚  ì™„ë£Œ                                                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Jenkins ë¹Œë“œ íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„°          | ì„¤ëª…           | ê¸°ë³¸ê°’  | ì˜ˆì‹œ                       |
|---------------|--------------|------|--------------------------|
| `LOG_LEVEL`   | Gradle ë¡œê·¸ ë ˆë²¨ | warn | debug, info, warn, error |
| `SKIP_STAGES` | ìŠ¤í‚µí•  ìŠ¤í…Œì´ì§€ ë²ˆí˜¸  | ""   | "1,3,5"                  |

### Credentials

Jenkins Credentialsì— ë“±ë¡ í•„ìš”:

| ID       | íƒ€ì…                | ìš©ë„                        |
|----------|-------------------|---------------------------|
| `nexus`  | Username/Password | Maven ì €ì¥ì†Œ ì¸ì¦              |
| `github` | Username/Password | GitHub ì €ì¥ì†Œ ì¸ì¦ (Helm repo) |

```groovy
withCredentials([
        usernamePassword(credentialsId: 'nexus',
                usernameVariable: 'NEXUS_USERNAME',
                passwordVariable: 'NEXUS_PASSWORD'),
        usernamePassword(credentialsId: 'github',
                usernameVariable: 'GITHUB_USERNAME',
                passwordVariable: 'GITHUB_PASSWORD')
]) {
    // ì´ ë¸”ë¡ ì•ˆì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì‚¬ìš© ê°€ëŠ¥
    // Gradle Taskê°€ System.getenv()ë¡œ ì½ìŒ
}
```

---

## 4. Gradle í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡°

### 4.1 í”ŒëŸ¬ê·¸ì¸ ì§„ì…ì  - AppBuilderPlugin

**íŒŒì¼**: `AppBuilderPlugin.kt`

```kotlin
class AppBuilderPlugin : Plugin<Project> {

    override fun apply(project: Project) {
        // 1. ì¸ì½”ë”© ì„¤ì •
        System.setProperty("file.encoding", "UTF-8")

        // 2. ì „ì—­ ì„¤ì • Extension ë“±ë¡
        project.extensions.create(AppBuilderExtension.NAME, AppBuilderExtension::class.java, ...)

        // 3. íƒœìŠ¤í¬ ë“±ë¡
        registerTasks(project)
    }

    private fun registerTasks(project: Project) {
        project.tasks.register(GetTargetsTask.TASK_NAME, GetTargetsTask::class.java)
        project.tasks.register(AppBuilderTask.TASK_NAME, AppBuilderTask::class.java)
    }
}
```

### êµ¬ì¡°

```
AppBuilderPlugin
   â”‚
   â”œâ”€ AppBuilderExtension (ì „ì—­ ì„¤ì •)
   â”‚
   â”œâ”€ GetTargetsTask (ëª¨ë“ˆ ê°ì§€)
   â”‚
   â””â”€ AppBuilderTask (ë¹Œë“œ ì‹¤í–‰)
```

### 4.2 ì „ì—­ ì„¤ì • - AppBuilderExtension

**íŒŒì¼**: `extension/AppBuilderExtension.kt`

#### ì´ í”ŒëŸ¬ê·¸ì¸ vs ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸

| êµ¬ë¶„    | ì´ í”ŒëŸ¬ê·¸ì¸ (app-builder-plugin)            | ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸ (order, payment ë“±)  |
|-------|----------------------------------------|--------------------------------|
| ì—­í•     | í”ŒëŸ¬ê·¸ì¸ **ì œê³µ**                            | í”ŒëŸ¬ê·¸ì¸ **ì‚¬ìš©**                    |
| ì „ì—­ ì„¤ì • | ì„¤ì • **ìŠ¤í‚¤ë§ˆ ì •ì˜** (AppBuilderExtension.kt) | ì„¤ì • **ê°’ ì„¸íŒ…** (build.gradle.kts) |

```
â”Œâ”€ ì´ í”ŒëŸ¬ê·¸ì¸ (app-builder-plugin) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                              â”‚
â”‚  AppBuilderExtension.kt:                     â”‚
â”‚    abstract class AppBuilderExtension {      â”‚
â”‚      var ecrRegistry: Property<String>  // ì†ì„± ì •ì˜
â”‚      var helmValuesRepo: Property<String>    â”‚
â”‚      val nexus: NexusConfig                  â”‚
â”‚      ...                                     â”‚
â”‚    }                                         â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ order í”„ë¡œì íŠ¸ (ë¹Œë“œ ëŒ€ìƒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                              â”‚
â”‚  build.gradle.kts:                           â”‚
â”‚    plugins {                                 â”‚
â”‚      id("com.example.plugins.app-builder-gradle-plugin")
â”‚    }                                         â”‚
â”‚                                              â”‚
â”‚    appBuilder {   â† ì‹¤ì œ ê°’ ì„¸íŒ…!             â”‚
â”‚      ecrRegistry.set("123.ecr.aws.com")      â”‚
â”‚      helmValuesRepo.set("github.com/...")    â”‚
â”‚      nexus {                                 â”‚
â”‚        username.set(System.getenv("NEXUS_USERNAME"))
â”‚      }                                       â”‚
â”‚    }                                         â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ê¸°ë³¸ ì„¤ì •

| ì†ì„±                | ì„¤ëª…                                |
|-------------------|-----------------------------------|
| `ecrRegistry`     | AWS ECR ì£¼ì†Œ (Docker ì´ë¯¸ì§€ ì €ì¥ì†Œ)       |
| `helmValuesRepo`  | Helm values Git ì €ì¥ì†Œ (ArgoCD ë°°í¬ìš©)  |
| `workspace`       | ì‘ì—… ë””ë ‰í† ë¦¬                           |
| `modulesFileName` | ëª¨ë“ˆ ì •ë³´ íŒŒì¼ëª… (ê¸°ë³¸: modules-data.json) |

#### ì„œë¹„ìŠ¤ë³„ Config

| Config         | ìš©ë„                            |
|----------------|-------------------------------|
| `nexus`        | Maven ì €ì¥ì†Œ ì¸ì¦                  |
| `github`       | GitHub ì¸ì¦ (Helm repo ì ‘ê·¼)      |
| `git`          | Git ì»¤ë°‹ ì‘ì„±ì ì •ë³´                 |
| `configServer` | Spring Cloud Config Server ì£¼ì†Œ |
| `spring`       | Spring í”„ë¡œíŒŒì¼ ì„¤ì •                |
| `node`         | Node.js í™˜ê²½ ì„¤ì •                 |
| `go`           | Go í”„ë¡œíŒŒì¼ ì„¤ì •                    |

#### ê°’ ì„¤ì • ë°©ë²•

ê°’ì´ ì„¤ì •ë˜ëŠ” ê²½ë¡œëŠ” **ë‘ ê°€ì§€**ë‹¤:

| ì„¤ì •                                 | ì–´ë””ì„œ ì˜¤ëŠ”ì§€                             |
|------------------------------------|-------------------------------------|
| `NEXUS_USERNAME/PASSWORD`          | Jenkins Credentials (`nexus`)       |
| `GITHUB_USERNAME/PASSWORD`         | Jenkins Credentials (`github`)      |
| `ECR_REGISTRY`, `helmValuesRepo` ë“± | ì‚¬ìš©ì í”„ë¡œì íŠ¸ `build.gradle.kts`ì—ì„œ ì§ì ‘ ì„¤ì • |

#### ê°’ ì£¼ì… íë¦„

```
â”Œâ”€ Jenkinsfile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @Library('app-builder-gradle-plugin') _      â”‚
â”‚  build()     â† íŒŒë¼ë¯¸í„° ì—†ì´ í˜¸ì¶œ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€ build.groovy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  withCredentials([...]) {                     â”‚
â”‚      // Jenkins Credentialsì—ì„œ ìë™ ì£¼ì…      â”‚
â”‚      env.NEXUS_USERNAME = "xxx"               â”‚
â”‚      env.NEXUS_PASSWORD = "xxx"               â”‚
â”‚      env.GITHUB_USERNAME = "xxx"              â”‚
â”‚      env.GITHUB_PASSWORD = "xxx"              â”‚
â”‚  }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€ ì‚¬ìš©ì í”„ë¡œì íŠ¸ build.gradle.kts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  appBuilder {                                 â”‚
â”‚      ecrRegistry.set("123.ecr.aws.com")  // ì§ì ‘ ì„¤ì •
â”‚      nexus {                                  â”‚
â”‚          username.set(System.getenv("NEXUS_USERNAME"))
â”‚          password.set(System.getenv("NEXUS_PASSWORD"))
â”‚      }                                        â”‚
â”‚  }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€ AppBuilderExtension â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ecrRegistry, nexus.username ë“± ê°’ ì €ì¥       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ë°ì´í„° ëª¨ë¸ - Entity

### ë°ì´í„° ëª¨ë¸ì´ ë‹´ëŠ” ì •ë³´

ë°ì´í„° ëª¨ë¸ì€ **í”ŒëŸ¬ê·¸ì¸ ìì²´ì˜ ì •ë³´ê°€ ì•„ë‹ˆë¼, í”ŒëŸ¬ê·¸ì¸ì„ í˜¸ì¶œí•œ í”„ë¡œì íŠ¸ì˜ ì •ë³´**ë¥¼ ë‹´ëŠ”ë‹¤.

| ëª¨ë¸           | ë‹´ëŠ” ì •ë³´                                   |
|--------------|-----------------------------------------|
| `CommitInfo` | ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸(order, payment ë“±)ì˜ Git ì»¤ë°‹ ì •ë³´ |
| `ModuleInfo` | ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸ì˜ ê° ëª¨ë“ˆ ì •ë³´                     |
| `BuildInfo`  | ìœ„ ë‘ ê°œë¥¼ í•©ì¹œ ì „ì²´ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸                    |

### ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸ì—ì„œ í”ŒëŸ¬ê·¸ì¸ ì‚¬ìš©ë²•

```kotlin
// order í”„ë¡œì íŠ¸ì˜ build.gradle.kts
plugins {
    id("com.example.plugins.app-builder-gradle-plugin") version "1.0.0"
}

appBuilder {
    ecrRegistry.set("123456789.dkr.ecr.ap-northeast-2.amazonaws.com")
    helmValuesRepo.set("https://github.com/myorg/helm-values.git")

    nexus {
        username.set(System.getenv("NEXUS_USERNAME"))
        password.set(System.getenv("NEXUS_PASSWORD"))
    }

    github {
        username.set(System.getenv("GITHUB_USERNAME"))
        password.set(System.getenv("GITHUB_PASSWORD"))
    }
}
```

### ì˜ˆì‹œ: order í”„ë¡œì íŠ¸ â†’ ë°ì´í„° ëª¨ë¸ ìƒì„±

```
â”Œâ”€ order í”„ë¡œì íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                              â”‚
â”‚  build.gradle.kts:                           â”‚
â”‚    plugins {                                 â”‚
â”‚      id("com.example.plugins.app-builder-gradle-plugin")
â”‚    }                                         â”‚
â”‚    appBuilder { ... }                        â”‚
â”‚                                              â”‚
â”‚  Jenkinsfile:                                â”‚
â”‚    @Library('app-builder-gradle-plugin') _   â”‚
â”‚    build()                                   â”‚
â”‚                                              â”‚
â”‚  settings.gradle.kts:                        â”‚
â”‚    include("order-api")                        â”‚
â”‚    include("order-batch")                      â”‚
â”‚    include("order-common")                     â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ í”ŒëŸ¬ê·¸ì¸ì´ order í”„ë¡œì íŠ¸ë¥¼ ë¶„ì„
        â–¼
â”Œâ”€ ìƒì„±ë˜ëŠ” ë°ì´í„° ëª¨ë¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BuildInfo {                                 â”‚
â”‚    commit: {                                 â”‚
â”‚      repo: "order",                            â”‚
â”‚      branch: "develop",                      â”‚
â”‚      author: "í™ê¸¸ë™"                         â”‚
â”‚    },                                        â”‚
â”‚    modules: {                                â”‚
â”‚      "order-api": { language: "JAVA", type: "app", changed: true },
â”‚      "order-batch": { language: "JAVA", type: "app", changed: false },
â”‚      "order-common": { language: "JAVA", type: "lib", changed: true }
â”‚    }                                         â”‚
â”‚  }                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê°’ ì„¸íŒ…ì— ì‚¬ìš©ë˜ëŠ” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤

DetectorExecutorì—ì„œ ê° ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ ê°’ì„ ì„¸íŒ…í•œë‹¤.

#### CommitInfo ê°’ ì„¸íŒ…

```kotlin
// DetectorExecutor.kt
val gitUtils = GitUtils(project, logger, workspace)
val commitInfo = gitUtils.collectCommitInfo()
```

| í•„ë“œ              | ì„¸íŒ…í•˜ëŠ” ê³³                        | ë°©ë²•                  |
|-----------------|-------------------------------|---------------------|
| `repo`          | `GitUtils.getRepoName()`      | Git remote URLì—ì„œ ì¶”ì¶œ |
| `branch`        | `GitUtils.getCurrentBranch()` | í˜„ì¬ ë¸Œëœì¹˜              |
| `author`        | `GitUtils.getCommitAuthor()`  | ìµœê·¼ ì»¤ë°‹ ì‘ì„±ì           |
| `commitMessage` | `GitUtils.getCommitMessage()` | ìµœê·¼ ì»¤ë°‹ ë©”ì‹œì§€           |

#### ModuleInfo ê°’ ì„¸íŒ…

```kotlin
// DetectorExecutor.kt
val allModules = ModuleDiscoveryUtils.discoverAllModules(...)
val moduleTypes = DockerfileUtils.determineModuleTypes(...)
val moduleLanguages = LanguageDetectionUtils.detectLanguagesForModules(...)
val changedModules = DependencyAnalysisUtils.detectChangedModulesWithDependencyAnalysis(...)
```

| í•„ë“œ         | ì„¸íŒ…í•˜ëŠ” ìœ í‹¸ë¦¬í‹°                            | ë°©ë²•                                                 |
|------------|--------------------------------------|----------------------------------------------------|
| `index`    | `forEachIndexed`                     | ìˆœì„œëŒ€ë¡œ 0, 1, 2...                                    |
| `name`     | `ModuleDiscoveryUtils`               | settings.gradle íŒŒì‹±                                 |
| `language` | `LanguageDetectionUtils`             | Dockerfile FROMì ˆ / ë¹Œë“œíŒŒì¼ í™•ì¸                         |
| `type`     | `DockerfileUtils`                    | Dockerfile.app.* â†’ "app", Dockerfile.lib.* â†’ "lib" |
| `changed`  | `DependencyAnalysisUtils`            | Git diff + ì˜ì¡´ì„± ì „íŒŒ ë¶„ì„                               |
| `version`  | `GitTagUtils` / `ModuleVersionUtils` | Git íƒœê·¸ ë˜ëŠ” build.gradleì—ì„œ ì¶”ì¶œ                        |
| `status`   | ê¸°ë³¸ê°’                                  | "SUCCESS"                                          |

#### ê°’ ì„¸íŒ… íë¦„ë„

```
DetectorExecutor.execute()
        â”‚
        â”œâ”€ GitUtils.collectCommitInfo()
        â”‚      â””â”€ CommitInfo { repo, branch, author, commitMessage }
        â”‚
        â”œâ”€ ModuleDiscoveryUtils.discoverAllModules()
        â”‚      â””â”€ ["order-api", "order-batch", "order-common"]
        â”‚
        â”œâ”€ DockerfileUtils.determineModuleTypes()
        â”‚      â””â”€ { "order-api": "app", "order-common": "lib" }
        â”‚
        â”œâ”€ LanguageDetectionUtils.detectLanguagesForModules()
        â”‚      â””â”€ { "order-api": "JAVA", "order-batch": "JAVA" }
        â”‚
        â”œâ”€ DependencyAnalysisUtils.detectChangedModules...()
        â”‚      â””â”€ ["order-api", "order-common"]  // ë³€ê²½ëœ ê²ƒë§Œ
        â”‚
        â””â”€ createAndSaveBuildInfo()
               â””â”€ ModuleInfo ì¡°í•©í•´ì„œ BuildInfo ìƒì„±
```

### ë°ì´í„° í´ë˜ìŠ¤ ì •ì˜

#### CommitInfo

```kotlin
data class CommitInfo(
    val repo: String,          // ì €ì¥ì†Œ ì´ë¦„
    val branch: String,        // ë¸Œëœì¹˜
    val author: String,        // ì»¤ë°‹ ì‘ì„±ì
    val commitMessage: String  // ì»¤ë°‹ ë©”ì‹œì§€
)
```

#### ModuleInfo

```kotlin
data class ModuleInfo(
    var index: Int,        // ë¹Œë“œ ìˆœì„œ (í† í´ë¡œì§€ ì •ë ¬ ê²°ê³¼)
    val name: String,      // ëª¨ë“ˆ ì´ë¦„
    val language: String,  // ì–¸ì–´ (JAVA, NODE, GO ë“±)
    val type: String,      // íƒ€ì… (app: ë°°í¬ìš©, lib: ë¼ì´ë¸ŒëŸ¬ë¦¬)
    var changed: Boolean,  // ë³€ê²½ ì—¬ë¶€ (trueë©´ ë¹Œë“œ ëŒ€ìƒ)
    var version: String?,  // ë²„ì „
    var status: String,    // ìƒíƒœ (pending, SUCCESS, FAILED)
)
```

#### BuildInfo

```kotlin
data class BuildInfo(
    val commit: CommitInfo,              // Git ì»¤ë°‹ ì •ë³´
    val modules: Map<String, ModuleInfo> // ëª¨ë“ˆëª… â†’ ëª¨ë“ˆì •ë³´ ë§µ
)
```

---

## 6. ëª¨ë“ˆ ê°ì§€ - GetTargetsTask

### Gradleì˜ Project ê°ì²´ë€?

GetTargetsTask ì½”ë“œì—ì„œ `project`ëŠ” **Gradleì˜ í•µì‹¬ ê°ì²´**ë‹¤:

```kotlin
val executor = DetectorExecutor(project, logger)
```

`org.gradle.api.Project`ëŠ” Gradleì´ ë¹Œë“œí•  ë•Œ ìë™ìœ¼ë¡œ ì£¼ì…í•˜ëŠ” ê°ì²´ë¡œ, í˜„ì¬ ë¹Œë“œ ì¤‘ì¸ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

```
â”Œâ”€ org.gradle.api.Project â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  í”„ë¡œì íŠ¸ ì •ë³´                                                    â”‚
â”‚  â”œâ”€ project.name          â†’ "app-builder-gradle-plugin"         â”‚
â”‚  â”œâ”€ project.rootDir       â†’ /workspace/app-builder-plugin       â”‚
â”‚  â”œâ”€ project.projectDir    â†’ /workspace/app-builder-plugin       â”‚
â”‚  â””â”€ project.buildDir      â†’ /workspace/.../build                â”‚
â”‚                                                                  â”‚
â”‚  ë¹Œë“œ ì„¤ì •                                                        â”‚
â”‚  â”œâ”€ project.extensions    â†’ í”ŒëŸ¬ê·¸ì¸ Extensionë“¤ (AppBuilderExtension)
â”‚  â”œâ”€ project.tasks         â†’ ë“±ë¡ëœ Taskë“¤                        â”‚
â”‚  â””â”€ project.properties    â†’ gradle.properties ê°’ë“¤               â”‚
â”‚                                                                  â”‚
â”‚  ë¡œê¹…                                                            â”‚
â”‚  â””â”€ project.logger        â†’ Gradle ë¡œê±° (debug, info, warn...)  â”‚
â”‚                                                                  â”‚
â”‚  ì„œë¸Œí”„ë¡œì íŠ¸ (ë©€í‹°ëª¨ë“ˆ)                                           â”‚
â”‚  â”œâ”€ project.rootProject   â†’ ë£¨íŠ¸ í”„ë¡œì íŠ¸                        â”‚
â”‚  â”œâ”€ project.subprojects   â†’ í•˜ìœ„ í”„ë¡œì íŠ¸ë“¤                       â”‚
â”‚  â””â”€ project.allprojects   â†’ ì „ì²´ í”„ë¡œì íŠ¸ë“¤                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¤‘ìš”**: ì´ í”ŒëŸ¬ê·¸ì¸ì—ì„œ `project`ëŠ” **app-builder-plugin í”„ë¡œì íŠ¸**ë¥¼ ê°€ë¦¬í‚¨ë‹¤. ë¹Œë“œ ëŒ€ìƒì¸ order, payment í”„ë¡œì íŠ¸ê°€ ì•„ë‹ˆë‹¤!

```
â”Œâ”€ Jenkins workspace â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  /workspace/order/              â† ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸ (workspace) â”‚
â”‚  â”‚                                                              â”‚
â”‚  â””â”€ /workspace/app-builder-plugin/  â† í”ŒëŸ¬ê·¸ì¸ (project)       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ë”°ë¼ì„œ `workspace` íŒŒë¼ë¯¸í„°ë¡œ ì‹¤ì œ ë¹Œë“œ ëŒ€ìƒ ê²½ë¡œë¥¼ ë³„ë„ë¡œ ì „ë‹¬í•œë‹¤.

### GetTargetsTask ìƒì„¸

**íŒŒì¼**: `tasks/targets/GetTargetsTask.kt`

```kotlin
open class GetTargetsTask : DefaultTask() {

    // Gradleì´ ì£¼ì…í•˜ëŠ” project ê°ì²´ (DefaultTaskì—ì„œ ìƒì†)
    // this.project â†’ org.gradle.api.Project

    @Internal
    val extension = project.extensions.getByName(GetTargetsTaskExtension.NAME)

    @Internal
    val appBuilderExtension = project.extensions.getByName(AppBuilderExtension.NAME)

    @TaskAction
    fun execute() {
        // 1. íŒŒë¼ë¯¸í„° ë° í™˜ê²½ë³€ìˆ˜ ì²˜ë¦¬
        val (targetModule, workspace) = processParameters()

        // 2. DetectorExecutorì— í•µì‹¬ ë¡œì§ ìœ„ì„
        val executor = DetectorExecutor(project, logger)
        executor.execute(
            workspace = workspace,  // ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸ ê²½ë¡œ
            excludeDirectoryPatterns = extension.excludeDirectoryPatterns,
            excludeFilePatterns = extension.excludeFilePatterns
        )
    }

    private fun processParameters(): Pair<String?, File> {
        // workspace: í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” Extensionì—ì„œ ê°€ì ¸ì˜´
        val workspace = try {
            appBuilderExtension.workspace.get()
        } catch (e: Exception) {
            project.rootDir  // ê¸°ë³¸ê°’: í”ŒëŸ¬ê·¸ì¸ í”„ë¡œì íŠ¸ ë£¨íŠ¸
        }

        return Pair(targetModule, workspace)
    }
}
```

### DetectorExecutor - í•µì‹¬ ë¡œì§

**íŒŒì¼**: `tasks/targets/executor/DetectorExecutor.kt`

```kotlin
class DetectorExecutor(
    private val project: Project,  // Gradle Project ê°ì²´
    private val logger: Logger     // Gradle ë¡œê±°
) {

    fun execute(workspace: File, ...): BuildInfo {
        // 1. Git ì»¤ë°‹ ì •ë³´ ìˆ˜ì§‘
        val gitUtils = GitUtils(project, logger, workspace)
        val commitInfo = gitUtils.collectCommitInfo()

        // 2. ëª¨ë“  ëª¨ë“ˆ ë°œê²¬ (settings.gradle íŒŒì‹±)
        val allModules = ModuleDiscoveryUtils.discoverAllModules(project, workspace)

        // 3. ëª¨ë“ˆ íƒ€ì… ê²°ì • (Dockerfile ê¸°ë°˜ app/lib)
        val moduleTypes = DockerfileUtils.determineModuleTypes(allModules, workspace, project)

        // 4. ëª¨ë“ˆ ì–¸ì–´ ê°ì§€ (JAVA, NODE, GO...)
        val moduleLanguages = LanguageDetectionUtils.detectLanguagesForModules(allModules, workspace, project)

        // 5. ë³€ê²½ëœ ëª¨ë“ˆ ê°ì§€ (Git diff + ì˜ì¡´ì„± ë¶„ì„)
        val changedModules = detectChangedModules(allModules, workspace, ...)

        // 6. BuildInfo ìƒì„± ë° JSON ì €ì¥
        val buildInfo = createAndSaveBuildInfo(commitInfo, allModules, ...)

        return buildInfo
    }
}
```

### ì‹¤í–‰ íë¦„

```
./gradlew GetTargets
        â”‚
        â–¼
â”Œâ”€ GetTargetsTask â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  processParameters()                                           â”‚
â”‚    â””â”€ workspace = /workspace/order (ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€ DetectorExecutor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  â‘  GitUtils.collectCommitInfo()                                â”‚
â”‚     â””â”€ Git ëª…ë ¹ì–´ë¡œ repo, branch, author, message ìˆ˜ì§‘         â”‚
â”‚                                                                 â”‚
â”‚  â‘¡ ModuleDiscoveryUtils.discoverAllModules()                   â”‚
â”‚     â””â”€ settings.gradle íŒŒì‹±í•˜ì—¬ ëª¨ë“ˆ ëª©ë¡ ì¶”ì¶œ                   â”‚
â”‚                                                                 â”‚
â”‚  â‘¢ DockerfileUtils.determineModuleTypes()                      â”‚
â”‚     â””â”€ Dockerfile.app.* / Dockerfile.lib.* íŒŒì¼ë¡œ íƒ€ì… ê²°ì •    â”‚
â”‚                                                                 â”‚
â”‚  â‘£ LanguageDetectionUtils.detectLanguagesForModules()          â”‚
â”‚     â””â”€ build.gradle, package.json ë“±ìœ¼ë¡œ ì–¸ì–´ ê°ì§€              â”‚
â”‚                                                                 â”‚
â”‚  â‘¤ DependencyAnalysisUtils.detectChangedModulesWithDependency..â”‚
â”‚     â”œâ”€ Git diffë¡œ ë³€ê²½ íŒŒì¼ ê°ì§€                                â”‚
â”‚     â”œâ”€ ì˜ì¡´ì„± ê·¸ë˜í”„ êµ¬ì¶•                                       â”‚
â”‚     â”œâ”€ ì˜ì¡´ì„± ì „íŒŒ ë¶„ì„                                         â”‚
â”‚     â””â”€ í† í´ë¡œì§€ ì •ë ¬ë¡œ ë¹Œë“œ ìˆœì„œ ê²°ì •                            â”‚
â”‚                                                                 â”‚
â”‚  â‘¥ createAndSaveBuildInfo()                                    â”‚
â”‚     â””â”€ modules-data.json íŒŒì¼ ìƒì„±                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
build/app-builder/modules-data.json ìƒì„±
```

### ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ ìƒì„¸

#### 1. GitUtils - Git ì •ë³´ ìˆ˜ì§‘

**íŒŒì¼**: `utils/GitUtils.kt`

```kotlin
class GitUtils(
    private val project: Project,
    private val logger: Logger,
    private val workspace: File    // Git ì €ì¥ì†Œ ìœ„ì¹˜
) {
    // Git ëª…ë ¹ì–´ ì‹¤í–‰
    fun execGitCommand(vararg args: String): String {
        val process = ProcessBuilder("git", *args)
            .directory(workspace)  // workspaceì—ì„œ ì‹¤í–‰!
            .start()
        return process.inputStream.bufferedReader().readText()
    }

    // ì»¤ë°‹ ì •ë³´ ìˆ˜ì§‘
    fun collectCommitInfo(): CommitInfo {
        val repo = getRepoName()           // git config --get remote.origin.url
        val branch = getCurrentBranch()     // git branch --show-current
        val author = getCommitAuthor()      // git log -1 --pretty=format:%an <%ae>
        val commitMessage = getCommitMessage()  // git log -1 --pretty=format:%s

        return CommitInfo.create(repo, branch, author, commitMessage)
    }
}
```

**ì‹¤í–‰ë˜ëŠ” Git ëª…ë ¹ì–´:**

| ì •ë³´      | Git ëª…ë ¹ì–´                                           | ì˜ˆì‹œ ê²°ê³¼                     |
|---------|---------------------------------------------------|---------------------------|
| repo    | `git config --get remote.origin.url` â†’ ì´ë¦„ ì¶”ì¶œ      | `order`                   |
| branch  | `BRANCH_NAME` í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” `git branch --show-current` | `develop`                 |
| author  | `git log -1 --pretty=format:%an <%ae>`            | `hong <hong@example.com>` |
| message | `git log -1 --pretty=format:%s`                   | `feat: ì£¼ë¬¸ API ê°œì„ `         |

#### 2. ModuleDiscoveryUtils - ëª¨ë“ˆ ë°œê²¬

**íŒŒì¼**: `tasks/targets/utils/ModuleDiscoveryUtils.kt`

settings.gradle[.kts] íŒŒì¼ì„ íŒŒì‹±í•˜ì—¬ ëª¨ë“  ëª¨ë“ˆì„ ë°œê²¬í•œë‹¤:

```kotlin
object ModuleDiscoveryUtils {

    fun discoverAllModules(project: Project, workspace: File): List<String> {
        return parseSettingsFile(workspace, project)
    }

    private fun parseSettingsFile(workspace: File, project: Project): List<String> {
        val modules = mutableListOf<String>()

        // settings.gradle ë˜ëŠ” settings.gradle.kts íŒŒì¼ ì°¾ê¸°
        val settingsFile = listOf(
            File(workspace, "settings.gradle"),
            File(workspace, "settings.gradle.kts")
        ).firstOrNull { it.exists() }

        if (settingsFile != null) {
            val content = settingsFile.readText()

            // include êµ¬ë¬¸ íŒŒì‹±
            // include("order-api")
            // include 'order-batch'
            val pattern1 = Regex("""include\s*\(\s*['"]([^'"]+)['"]\s*\)""")
            val pattern2 = Regex("""include\s+['"]([^'"]+)['"]""")

            pattern1.findAll(content).forEach { modules.add(it.groupValues[1]) }
            pattern2.findAll(content).forEach { modules.add(it.groupValues[1]) }
        }

        return modules.distinct()
    }
}
```

**ì˜ˆì‹œ:**

```kotlin
// settings.gradle.kts
rootProject.name = "order"
include("order-api")      // â† ì¶”ì¶œë¨
include("order-batch")    // â† ì¶”ì¶œë¨
include("order-common")   // â† ì¶”ì¶œë¨
```

ê²°ê³¼: `["order-api", "order-batch", "order-common"]`

#### 3. DockerfileUtils - ëª¨ë“ˆ íƒ€ì… ê²°ì •

**íŒŒì¼**: `tasks/targets/utils/DockerfileUtils.kt`

Dockerfile ì´ë¦„ ê·œì¹™ìœ¼ë¡œ ëª¨ë“ˆ íƒ€ì…(app/lib)ì„ ê²°ì •í•œë‹¤:

```kotlin
object DockerfileUtils {

    const val MODULE_TYPE_APP = "app"  // ë°°í¬ ëŒ€ìƒ (Docker ì´ë¯¸ì§€ ìƒì„±)
    const val MODULE_TYPE_LIB = "lib"  // ë¼ì´ë¸ŒëŸ¬ë¦¬ (Maven ë°°í¬ë§Œ)

    fun determineModuleTypes(modules: List<String>, workspace: File, project: Project): Map<String, String> {
        return modules.associateWith { module ->
            determineModuleType(module, workspace)
        }
    }

    private fun determineModuleType(module: String, workspace: File): String {
        // Dockerfile.app.{module} íŒŒì¼ì´ ìˆìœ¼ë©´ app
        val appDockerfile = File(workspace, "Dockerfile.app.$module")
        if (appDockerfile.exists()) return MODULE_TYPE_APP

        // Dockerfile.lib.{module} íŒŒì¼ì´ ìˆìœ¼ë©´ lib
        val libDockerfile = File(workspace, "Dockerfile.lib.$module")
        if (libDockerfile.exists()) return MODULE_TYPE_LIB

        return MODULE_TYPE_LIB  // ê¸°ë³¸ê°’
    }

    // Dockerfileì´ ìˆëŠ” ëª¨ë“ˆë§Œ í•„í„°ë§ (ë¹Œë“œ ëŒ€ìƒ)
    fun filterModulesWithDockerfiles(modules: List<String>, workspace: File, project: Project): List<String> {
        return modules.filter { module ->
            File(workspace, "Dockerfile.app.$module").exists() ||
                    File(workspace, "Dockerfile.lib.$module").exists()
        }
    }
}
```

**ì˜ˆì‹œ:**

```
/workspace/order/
â”œâ”€â”€ Dockerfile.app.order-api      â† order-api â†’ "app"
â”œâ”€â”€ Dockerfile.app.order-batch    â† order-batch â†’ "app"
â”œâ”€â”€ Dockerfile.lib.order-common   â† order-common â†’ "lib"
â””â”€â”€ order-client/                 â† Dockerfile ì—†ìŒ â†’ ë¹Œë“œ ì œì™¸
```

#### 4. ChangeDetectionUtils - ë³€ê²½ ê°ì§€

**íŒŒì¼**: `tasks/targets/utils/ChangeDetectionUtils.kt`

Git diffë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ê²½ëœ íŒŒì¼ì„ ê°ì§€í•˜ê³ , í•´ë‹¹ íŒŒì¼ì´ ì†í•œ ëª¨ë“ˆì„ ì°¾ëŠ”ë‹¤:

```kotlin
object ChangeDetectionUtils {

    fun detectChangedModulesWithFiltering(
        modules: List<String>,
        workspace: File,
        project: Project,
        gitUtils: GitUtils,
        excludeDirectoryPatterns: List<String>,
        excludeFilePatterns: List<String>
    ): List<String> {

        // 1. ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ ì¡°íšŒ (3ë‹¨ê³„ ì‹œë„)
        val changedFiles = getChangedFilesMultiStage(workspace, project, gitUtils)

        // 2. ì œì™¸ íŒ¨í„´ í•„í„°ë§
        val filteredFiles = processAndFilterFiles(changedFiles, excludePatterns...)

        // 3. ë³€ê²½ëœ ëª¨ë“ˆ ì°¾ê¸°
        val changedModules = findDirectlyChangedModules(filteredFiles, modules, workspace)

        return changedModules
    }
}
```

**3ë‹¨ê³„ ë³€ê²½ íŒŒì¼ ê°ì§€:**

```
â”Œâ”€ ë³€ê²½ íŒŒì¼ ê°ì§€ ì „ëµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  1ë‹¨ê³„: ì»¤ë°‹ ë¹„êµ (Jenkinsì—ì„œ ì£¼ë¡œ ì‚¬ìš©)                         â”‚
â”‚  â”œâ”€ ì¼ë°˜ ì»¤ë°‹: git diff --name-only HEAD~1 HEAD                 â”‚
â”‚  â””â”€ Merge ì»¤ë°‹: git diff --name-only {ì²«ë²ˆì§¸ ë¶€ëª¨} HEAD         â”‚
â”‚                                                                  â”‚
â”‚         â†“ íŒŒì¼ ì—†ìœ¼ë©´                                            â”‚
â”‚                                                                  â”‚
â”‚  2ë‹¨ê³„: Staged íŒŒì¼                                              â”‚
â”‚  â””â”€ git diff --cached --name-only                               â”‚
â”‚                                                                  â”‚
â”‚         â†“ íŒŒì¼ ì—†ìœ¼ë©´                                            â”‚
â”‚                                                                  â”‚
â”‚  3ë‹¨ê³„: Working directory                                        â”‚
â”‚  â””â”€ git diff --name-only                                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ëª¨ë“ˆ ë§¤ì¹­ ë¡œì§:**

```kotlin
private fun isModuleChanged(module: String, changedFiles: List<String>, ...): Boolean {
    return changedFiles.any { file ->
        when {
            // ëª¨ë“ˆ ë””ë ‰í† ë¦¬ ë‚´ íŒŒì¼ ë³€ê²½
            file.startsWith("$module/") -> true

            // ëª¨ë“ˆ ë¹Œë“œ íŒŒì¼ ë³€ê²½
            file == "$module/build.gradle.kts" -> true
            file == "$module/package.json" -> true

            // ëª¨ë“ˆë³„ Dockerfile ë³€ê²½
            file == "Dockerfile.app.$module" -> true
            file == "Dockerfile.lib.$module" -> true

            else -> false
        }
    }
}
```

**ì „ì—­ ë³€ê²½ íŒŒì¼ (ì „ì²´ ë¹Œë“œ íŠ¸ë¦¬ê±°):**

```kotlin
private fun findGlobalChanges(changedFiles: List<String>): List<String> {
    val rootFiles = setOf(
        "Jenkinsfile",
        "settings.gradle",
        "settings.gradle.kts",
        "gradle.properties"
    )
    // ì´ íŒŒì¼ì´ ë³€ê²½ë˜ë©´ ëª¨ë“  ëª¨ë“ˆ ë¹Œë“œ
    return changedFiles.filter { it in rootFiles }
}
```

#### 5. DependencyAnalysisUtils - ì˜ì¡´ì„± ë¶„ì„

**íŒŒì¼**: `tasks/targets/utils/DependencyAnalysisUtils.kt`

ë³€ê²½ëœ ëª¨ë“ˆì— ì˜ì¡´í•˜ëŠ” ë‹¤ë¥¸ ëª¨ë“ˆë„ í•¨ê»˜ ë¹Œë“œí•´ì•¼ í•œë‹¤:

```kotlin
object DependencyAnalysisUtils {

    fun detectChangedModulesWithDependencyAnalysis(
        allModules: List<String>,
        workspace: File,
        project: Project,
        logger: Logger,
        excludePatterns...
    ): List<String>
    {

        // 1. ì§ì ‘ ë³€ê²½ëœ ëª¨ë“ˆ ê°ì§€
        val directlyChangedModules = ChangeDetectionUtils.detectChangedModulesWithFiltering(...)

        // 2. ì˜ì¡´ì„± ê·¸ë˜í”„ êµ¬ì¶•
        val dependencyGraph = buildDependencyGraph(project, allModules, workspace)
        // ì˜ˆ: { "order-api": ["order-common"], "order-batch": ["order-common"] }

        // 3. Dockerfileì´ ìˆëŠ” ëª¨ë“ˆë§Œ í•„í„°ë§
        val dockerfileModules = DockerfileUtils.filterModulesWithDockerfiles(...)

        // 4. ì˜ì¡´ì„± ì „íŒŒ ë¶„ì„
        // order-common ë³€ê²½ â†’ order-api, order-batchë„ ë¹Œë“œ í•„ìš”
        val allAffectedModules = DependencyPropagationUtils.findAffected(
            changedModules = directlyChangedModules,
            dependencyGraph = dependencyGraph,
            dockerfileModules = dockerfileModules
        )

        // 5. í† í´ë¡œì§€ ì •ë ¬ (ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ ë¹Œë“œ)
        // order-common â†’ order-api â†’ order-batch ìˆœì„œ
        val orderedModules = TopologyUtils.topologicalSort(dependencyGraph)
            .filter { it in allAffectedModules }

        return orderedModules
    }
}
```

**ì˜ì¡´ì„± ì „íŒŒ ì˜ˆì‹œ:**

```
â”Œâ”€ ì˜ì¡´ì„± ê·¸ë˜í”„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚  order-api â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚                  â”œâ”€â”€â†’ order-common (ë¼ì´ë¸ŒëŸ¬ë¦¬)                   â”‚
â”‚  order-batch â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [ì‹œë‚˜ë¦¬ì˜¤] order-common ë³€ê²½ë¨                                    â”‚
â”‚                                                                   â”‚
â”‚  ì§ì ‘ ë³€ê²½: order-common                                          â”‚
â”‚  ì˜ì¡´ì„± ì „íŒŒ: order-api, order-batch (order-common ì‚¬ìš©)          â”‚
â”‚                                                                   â”‚
â”‚  ìµœì¢… ë¹Œë“œ ëŒ€ìƒ (í† í´ë¡œì§€ ìˆœì„œ):                                    â”‚
â”‚    1. order-common  â† ë¨¼ì € ë¹Œë“œ (ë¼ì´ë¸ŒëŸ¬ë¦¬)                       â”‚
â”‚    2. order-api     â† ë‹¤ìŒ ë¹Œë“œ (order-common ì‚¬ìš©)                â”‚
â”‚    3. order-batch   â† ë§ˆì§€ë§‰ ë¹Œë“œ                                 â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í† í´ë¡œì§€ ì •ë ¬(Topological Sort)ì´ë€?

**ì˜ì¡´ì„±ì´ ìˆëŠ” ì‘ì—…ë“¤ì„ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ì •ë ¬**í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.

í•µì‹¬ ì›ë¦¬: "Aê°€ Bì— ì˜ì¡´í•œë‹¤" â†’ "Bë¥¼ ë¨¼ì € ì²˜ë¦¬í•´ì•¼ í•œë‹¤"

**ì‹¤ì œ fax í”„ë¡œì íŠ¸ ì˜ˆì‹œ:**

```
â”Œâ”€ ì˜ì¡´ì„± ê´€ê³„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚   fax-api â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚                     â”œâ”€â”€â†’ fax (ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬)                  â”‚
â”‚   fax-batch â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                         â”‚
â”‚                     â”‚                                         â”‚
â”‚   fax-scheduler â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                â”‚
â”‚   fax-vendor-hanafax â”€â”€â†’ fax                                  â”‚
â”‚   fax-vendor-lg â”€â”€â”€â”€â”€â”€â”€â†’ fax                                  â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í† í´ë¡œì§€ ì •ë ¬ ê²°ê³¼:
  fax â†’ fax-api â†’ fax-batch â†’ fax-scheduler â†’ fax-vendor-*
  â†‘
  ë°˜ë“œì‹œ ë¨¼ì €! (ë‹¤ë¥¸ ëª¨ë“ˆë“¤ì´ ì˜ì¡´í•¨)
```

**ì™œ í•„ìš”í•œê°€?**

```
âŒ ì˜ëª»ëœ ìˆœì„œ (fax-api ë¨¼ì € ë¹Œë“œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. fax-api ë¹Œë“œ ì‹œë„                                           â”‚
â”‚     â†’ ì»´íŒŒì¼ ì—ëŸ¬! fax ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ì§ ì—†ìŒ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… ì˜¬ë°”ë¥¸ ìˆœì„œ (í† í´ë¡œì§€ ì •ë ¬ ì ìš©)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. fax ë¹Œë“œ â†’ Mavenì— ë°°í¬ (1.0.0-SNAPSHOT)                    â”‚
â”‚  2. fax-api ë¹Œë“œ â†’ fax:1.0.0-SNAPSHOT ì‚¬ìš© ê°€ëŠ¥!                â”‚
â”‚  3. fax-batch ë¹Œë“œ                                              â”‚
â”‚  4. ...                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì•Œê³ ë¦¬ì¦˜ ì›ë¦¬:**

```
1. ì˜ì¡´ì„±ì´ ì—†ëŠ” ë…¸ë“œ(ì§„ì… ì°¨ìˆ˜ 0)ë¥¼ ì°¾ëŠ”ë‹¤ â†’ fax
2. í•´ë‹¹ ë…¸ë“œë¥¼ ê²°ê³¼ì— ì¶”ê°€í•˜ê³  ê·¸ë˜í”„ì—ì„œ ì œê±°
3. ì œê±°ëœ ë…¸ë“œì— ì˜ì¡´í•˜ë˜ ë…¸ë“œë“¤ì˜ ì§„ì… ì°¨ìˆ˜ ê°ì†Œ
4. ë°˜ë³µ

â”Œâ”€ ë‹¨ê³„ë³„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  ì´ˆê¸°: fax(0), fax-api(1), fax-batch(1), fax-scheduler(1)      â”‚
â”‚        â†‘ ì§„ì…ì°¨ìˆ˜ 0 = ì•„ë¬´ê²ƒë„ ì˜ì¡´í•˜ì§€ ì•ŠìŒ                     â”‚
â”‚                                                                â”‚
â”‚  1ë‹¨ê³„: fax ì¶”ì¶œ â†’ [fax]                                       â”‚
â”‚         ë‚˜ë¨¸ì§€ ì§„ì…ì°¨ìˆ˜ ê°ì†Œ: fax-api(0), fax-batch(0), ...     â”‚
â”‚                                                                â”‚
â”‚  2ë‹¨ê³„: fax-api ì¶”ì¶œ â†’ [fax, fax-api]                          â”‚
â”‚  3ë‹¨ê³„: fax-batch ì¶”ì¶œ â†’ [fax, fax-api, fax-batch]             â”‚
â”‚  ...                                                           â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‹¤ì œ ì½”ë“œ (TopologyUtils.kt):**

```kotlin
fun topologicalSort(dependencyGraph: Map<String, List<String>>): List<String> {
    val result = mutableListOf<String>()
    val visited = mutableSetOf<String>()

    fun visit(node: String) {
        if (node in visited) return
        visited.add(node)

        // ì˜ì¡´í•˜ëŠ” ëª¨ë“ˆë“¤ ë¨¼ì € ë°©ë¬¸ (DFS)
        dependencyGraph[node]?.forEach { dependency ->
            visit(dependency)
        }

        result.add(node)
    }

    dependencyGraph.keys.forEach { visit(it) }
    return result
}
```

**ìš”ì•½**: lib ëª¨ë“ˆì„ app ëª¨ë“ˆë³´ë‹¤ ë¨¼ì € ë¹Œë“œí•˜ê¸° ìœ„í•œ ì •ë ¬ ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.

### ìµœì¢… ì¶œë ¥: modules-data.json

```json
{
  "commit": {
    "repo": "order",
    "branch": "develop",
    "author": "hong.gildong",
    "commitMessage": "feat: ì£¼ë¬¸ API ê°œì„ "
  },
  "modules": {
    "order-common": {
      "index": 0,
      "name": "order-common",
      "language": "JAVA",
      "type": "lib",
      "changed": true,
      "version": "1.0.0-SNAPSHOT",
      "status": "SUCCESS"
    },
    "order-api": {
      "index": 1,
      "name": "order-api",
      "language": "JAVA",
      "type": "app",
      "changed": true,
      "version": "1.2.3-develop",
      "status": "SUCCESS"
    },
    "order-batch": {
      "index": 2,
      "name": "order-batch",
      "language": "JAVA",
      "type": "app",
      "changed": false,
      "version": null,
      "status": "SUCCESS"
    }
  }
}
```

---

## 7. ë¹Œë“œ ì‹¤í–‰ - AppBuilderTask

### GetTargetsTask vs AppBuilderTask ë¹„êµ

| êµ¬ë¶„ | GetTargetsTask       | AppBuilderTask         |
|----|----------------------|------------------------|
| ì—­í•  | ë¹Œë“œ **ëŒ€ìƒ ê°ì§€**         | ì‹¤ì œ **ë¹Œë“œ ì‹¤í–‰**           |
| ì…ë ¥ | workspace (í”„ë¡œì íŠ¸ ê²½ë¡œ)  | targetModule (ëª¨ë“ˆëª…)     |
| ì¶œë ¥ | modules-data.json ìƒì„± | modules-data.json ì—…ë°ì´íŠ¸ |
| í˜¸ì¶œ | íŒŒì´í”„ë¼ì¸ ì‹œì‘ ì‹œ 1íšŒ        | ëª¨ë“ˆë³„ë¡œ NíšŒ ë°˜ë³µ í˜¸ì¶œ          |

```
â”Œâ”€ build.groovy íŒŒì´í”„ë¼ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  stage("ğŸ” ë³€ê²½ ê°ì§€") {                                         â”‚
â”‚      gradle GetTargets  â† 1íšŒ í˜¸ì¶œ                               â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  buildData.modules.each { module ->                              â”‚
â”‚      stage("[${module.language}] ${module.name}") {              â”‚
â”‚          gradle AppBuilder -PtargetModule=${module.name}         â”‚
â”‚      }                     â†‘ ëª¨ë“ˆë³„ ë°˜ë³µ í˜¸ì¶œ                     â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AppBuilderTask ìƒì„¸

**íŒŒì¼**: `tasks/builder/AppBuilderTask.kt`

```kotlin
open class AppBuilderTask : DefaultTask() {

    companion object {
        // Task ì´ë¦„: "AppBuilder" (Task ì ‘ë¯¸ì‚¬ ì œê±°)
        val TASK_NAME = AppBuilderTask::class.simpleName.toString().replace("Task", "")
    }

    // Extensionì—ì„œ ì„¤ì •ê°’ ê°€ì ¸ì˜¤ê¸°
    @Internal
    val extension = project.extensions.getByName(AppBuilderTaskExtension.NAME)

    @Internal
    val appBuilderExtension = project.extensions.getByName(AppBuilderExtension.NAME)

    @TaskAction
    fun execute() {
        try {
            // 1. íŒŒë¼ë¯¸í„° ë° í™˜ê²½ë³€ìˆ˜ ì²˜ë¦¬
            val (targetModule, workspace) = processParameters()

            // 2. AppBuilderExecutorì— í•µì‹¬ ë¡œì§ ìœ„ì„
            val executor = AppBuilderExecutor(project, logger)
            val result = executor.execute(targetModule, workspace)

            // 3. build.groovyë¥¼ ìœ„í•œ ê²°ê³¼ ì¶œë ¥ (íŒŒì‹±ìš©)
            println("[AppBuilderTask] $targetModule -> status=${result.status}, version=${result.version}")

        } catch (e: Exception) {
            logger.error("âŒ AppBuilderTask ì‹¤í–‰ ì‹¤íŒ¨: ${e.message}", e)
            throw e
        }
    }

    private fun processParameters(): Pair<String, File> {
        // targetModule: í•„ìˆ˜ íŒŒë¼ë¯¸í„° (-PtargetModule=fax-api)
        val targetModule = extension.targetModule.trim()
        if (targetModule.isEmpty()) {
            throw IllegalArgumentException(
                "targetModule íŒŒë¼ë¯¸í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤. -PtargetModule=ëª¨ë“ˆëª… ì„ ì‚¬ìš©í•˜ì„¸ìš”."
            )
        }

        // workspace: ë¹Œë“œ ëŒ€ìƒ í”„ë¡œì íŠ¸ ê²½ë¡œ
        val workspace = try {
            appBuilderExtension.workspace.get()
        } catch (e: Exception) {
            project.rootDir  // ê¸°ë³¸ê°’
        }

        return Pair(targetModule, workspace)
    }
}
```

**ì‚¬ìš©ë²•:**

```bash
# Gradle ì§ì ‘ ì‹¤í–‰
./gradlew AppBuilder -PtargetModule=fax-api

# build.groovyì—ì„œ í˜¸ì¶œ
gradle -p ${appBuilderPath} AppBuilder -PtargetModule=${module.name} --no-daemon
```

### AppBuilderExecutor - ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

**íŒŒì¼**: `tasks/builder/executor/AppBuilderExecutor.kt`

3ê°œì˜ Executorë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê³ , ê° ë‹¨ê³„ ê²°ê³¼ë¥¼ modules-data.jsonì— ì €ì¥í•œë‹¤.

```kotlin
class AppBuilderExecutor(
    private val project: Project,
    private val logger: Logger
) {

    // JSON íŒŒì¼ ìœ í‹¸ë¦¬í‹° (modules-data.json ì½ê¸°/ì“°ê¸°)
    private val jsonUtil = JsonUtil(
        baseDir = project.layout.buildDirectory.get().asFile,
        appBuilderPath = extension.appBuilderPath.getOrElse("/app-builder"),
        modulesFileName = extension.modulesFileName.getOrElse("modules-data.json")
    )

    fun execute(targetModule: String, workspace: File): ModuleInfo {
        try {
            // 1. modules-data.jsonì—ì„œ í˜„ì¬ ëª¨ë“ˆ ì •ë³´ ë¡œë“œ
            val buildInfo = loadBuildInfo()
            val moduleInfo = getModuleInfo(buildInfo, targetModule)

            // 2. ëª¨ë“ˆ ìœ íš¨ì„± ê²€ì¦
            validateModule(moduleInfo, targetModule)

            // 3. ë²„ì „ ê´€ë¦¬ (VersionExecutor)
            val versionExecutor = VersionExecutor(project, logger, workspace)
            val versionResult = versionExecutor.execute(moduleInfo)
            updateModuleInfo(targetModule, versionResult)  // JSON ì—…ë°ì´íŠ¸

            // ë²„ì „ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨
            if (versionResult.status != "SUCCESS") {
                logger.error("ë²„ì „ ì²˜ë¦¬ ì‹¤íŒ¨ë¡œ ë¹Œë“œë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤.")
                return versionResult
            }

            // 4. ëª¨ë“ˆ ë¹Œë“œ (BuildExecutor)
            val buildExecutor = BuildExecutor(project, logger, workspace)
            val buildResult = buildExecutor.execute(versionResult)
            updateModuleInfo(targetModule, buildResult)  // JSON ì—…ë°ì´íŠ¸

            // ë¹Œë“œ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨
            if (buildResult.status != "SUCCESS") {
                logger.error("ë¹Œë“œ ì‹¤íŒ¨ë¡œ íŒŒì´í”„ë¼ì¸ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.")
                return buildResult
            }

            // 5. Helm ì—…ë°ì´íŠ¸ (HelmExecutor) - app ëª¨ë“ˆë§Œ
            if (shouldUpdateHelm(buildResult)) {
                val helmExecutor = HelmExecutor(project, logger, workspace)
                val helmResult = helmExecutor.execute(buildResult)
                updateModuleInfo(targetModule, helmResult)  // JSON ì—…ë°ì´íŠ¸
                return helmResult
            }

            return buildResult

        } catch (e: Exception) {
            // ì‹¤íŒ¨ ì‹œ ëª¨ë“ˆ ìƒíƒœë¥¼ FAILEDë¡œ ì—…ë°ì´íŠ¸
            val failedInfo = createFailedModuleInfo(targetModule, e.message)
            updateModuleInfo(targetModule, failedInfo)
            throw e
        }
    }

    // Helm ì—…ë°ì´íŠ¸ í•„ìš” ì—¬ë¶€ íŒë‹¨
    private fun shouldUpdateHelm(moduleInfo: ModuleInfo): Boolean {
        // 1. app íƒ€ì…ë§Œ
        if (moduleInfo.type != "app") return false

        // 2. batch ëª¨ë“ˆ ì œì™¸
        val excludedPatterns = listOf("batch")
        val isExcluded = excludedPatterns.any { pattern ->
            moduleInfo.name.contains(pattern, ignoreCase = true)
        }

        return !isExcluded
    }

    // modules-data.json ì—…ë°ì´íŠ¸
    private fun updateModuleInfo(targetModule: String, updatedInfo: ModuleInfo) {
        val currentBuildInfo = jsonUtil.readBuildInfo()
        val updatedModules = currentBuildInfo.modules.toMutableMap()
        updatedModules[targetModule] = updatedInfo

        val updatedBuildInfo = BuildInfo.create(currentBuildInfo.commit, updatedModules)
        jsonUtil.writeBuildInfoAtomic(updatedBuildInfo)
    }
}
```

**ì‹¤íŒ¨ ì²˜ë¦¬ íë¦„:**

```
â”Œâ”€ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  VersionExecutor ì‹¤íŒ¨?                                          â”‚
â”‚        â”‚                                                         â”‚
â”‚        â”œâ”€ YES â†’ status: "FAILED" ë°˜í™˜ â†’ ë¹Œë“œ ì¤‘ë‹¨               â”‚
â”‚        â”‚        (BuildExecutor, HelmExecutor ìŠ¤í‚µ)               â”‚
â”‚        â”‚                                                         â”‚
â”‚        â””â”€ NO â†’ BuildExecutor ì‹¤í–‰                                â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â”œâ”€ ì‹¤íŒ¨ â†’ status: "FAILED" ë°˜í™˜             â”‚
â”‚                      â”‚        (HelmExecutor ìŠ¤í‚µ)                â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â””â”€ ì„±ê³µ â†’ HelmExecutor ì‹¤í–‰ (appë§Œ)         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‹¤í–‰ íë¦„ ìƒì„¸

```
./gradlew AppBuilder -PtargetModule=fax-api
        â”‚
        â–¼
â”Œâ”€ AppBuilderTask â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  processParameters()                                            â”‚
â”‚    â”œâ”€ targetModule = "fax-api" (-P íŒŒë¼ë¯¸í„°ì—ì„œ)                â”‚
â”‚    â””â”€ workspace = /workspace/fax (í™˜ê²½ë³€ìˆ˜ì—ì„œ)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€ AppBuilderExecutor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  â‘  loadBuildInfo()                                              â”‚
â”‚     â””â”€ modules-data.json ì½ê¸° (GetTargetsTaskê°€ ìƒì„±í•œ íŒŒì¼)     â”‚
â”‚                                                                  â”‚
â”‚  â‘¡ getModuleInfo("fax-api")                                     â”‚
â”‚     â””â”€ { name: "fax-api", type: "app", language: "JAVA", ... }  â”‚
â”‚                                                                  â”‚
â”‚  â‘¢ VersionExecutor.execute(moduleInfo)                         â”‚
â”‚     â”œâ”€ Git íƒœê·¸ fetch                                           â”‚
â”‚     â”œâ”€ ë‹¤ìŒ ë²„ì „ ê³„ì‚° â†’ "1.2.3-beta"                            â”‚
â”‚     â”œâ”€ Git íƒœê·¸ ìƒì„±: fax-api/v1.2.3-beta                       â”‚
â”‚     â””â”€ updateModuleInfo() â†’ JSON ì €ì¥                           â”‚
â”‚                                                                  â”‚
â”‚  â‘£ BuildExecutor.execute(versionResult)                        â”‚
â”‚     â”œâ”€ BuildContext ìƒì„± (Dockerfile, í™˜ê²½ë³€ìˆ˜ ë“±)              â”‚
â”‚     â”œâ”€ build.gradle ë²„ì „ ì—…ë°ì´íŠ¸                                â”‚
â”‚     â”œâ”€ buildctl ëª…ë ¹ì–´ ìƒì„± ë° ì‹¤í–‰                              â”‚
â”‚     â””â”€ updateModuleInfo() â†’ JSON ì €ì¥                           â”‚
â”‚                                                                  â”‚
â”‚  â‘¤ HelmExecutor.execute(buildResult)  â† app íƒ€ì…ë§Œ             â”‚
â”‚     â”œâ”€ Helm ì €ì¥ì†Œ í´ë¡                                          â”‚
â”‚     â”œâ”€ values.yaml image.tag ì—…ë°ì´íŠ¸                           â”‚
â”‚     â”œâ”€ Git ì»¤ë°‹ & í‘¸ì‹œ                                          â”‚
â”‚     â””â”€ updateModuleInfo() â†’ JSON ì €ì¥                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
println("[AppBuilderTask] fax-api -> status=SUCCESS, version=1.2.3-beta")
        â”‚
        â–¼
build.groovyê°€ ì¶œë ¥ íŒŒì‹±í•˜ì—¬ ê²°ê³¼ í™•ì¸
```

---

## 8. 3ê°€ì§€ Executor ìƒì„¸

ê° ExecutorëŠ” **ë‹¨ì¼ ì±…ì„ ì›ì¹™**ì— ë”°ë¼ ë¶„ë¦¬ë˜ì–´ ìˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Executor ì²´ì¸                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ModuleInfo { version: null }                                    â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€ VersionExecutor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ì…ë ¥: version ì—†ìŒ                                        â”‚  â”‚
â”‚  â”‚  ì²˜ë¦¬: Git íƒœê·¸ ê¸°ë°˜ ë²„ì „ ê³„ì‚° â†’ íƒœê·¸ ìƒì„±                  â”‚  â”‚
â”‚  â”‚  ì¶œë ¥: version: "1.2.3-beta"                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€ BuildExecutor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ì…ë ¥: version ìˆìŒ                                        â”‚  â”‚
â”‚  â”‚  ì²˜ë¦¬: build.gradle ìˆ˜ì • â†’ Docker ë¹Œë“œ â†’ ECR í‘¸ì‹œ          â”‚  â”‚
â”‚  â”‚  ì¶œë ¥: status: "SUCCESS"                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼ (app íƒ€ì…ë§Œ, batch ì œì™¸)                              â”‚
â”‚  â”Œâ”€ HelmExecutor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ì…ë ¥: ë¹Œë“œ ì™„ë£Œëœ ModuleInfo                              â”‚  â”‚
â”‚  â”‚  ì²˜ë¦¬: Helm values.yaml ì—…ë°ì´íŠ¸ â†’ Git í‘¸ì‹œ                â”‚  â”‚
â”‚  â”‚  ì¶œë ¥: status: "SUCCESS"                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  ModuleInfo { version: "1.2.3-beta", status: "SUCCESS" }        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.1 VersionExecutor - ë²„ì „ ê´€ë¦¬

**íŒŒì¼**: `tasks/builder/executor/VersionExecutor.kt`

Git íƒœê·¸ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ ë²„ì „ì„ ê³„ì‚°í•˜ê³  íƒœê·¸ë¥¼ ìƒì„±í•œë‹¤.

```kotlin
class VersionExecutor(
    private val project: Project,
    private val logger: Logger,
    private val workspace: File
) {
    private val gitUtils = GitUtils(project, logger, workspace)

    fun execute(moduleInfo: ModuleInfo): ModuleInfo {
        try {
            // 1. Git íƒœê·¸ ì´ˆê¸°í™” (ì›ê²© íƒœê·¸ ê°€ì ¸ì˜¤ê¸°)
            gitUtils.fetchModuleSpecificTags(moduleInfo.name)

            // 2. ë‹¤ìŒ ë²„ì „ ê³„ì‚°
            val versionInfo = calculateNextVersion(moduleInfo)

            // 3. Git íƒœê·¸ ìƒì„± ë° í‘¸ì‹œ
            if (versionInfo.shouldCreateTag) {
                GitTagUtils.createAndPushTag(
                    tagName = versionInfo.tagName,    // fax-api/v1.2.3-beta
                    version = versionInfo.version,    // 1.2.3-beta
                    gitUtils = gitUtils,
                    logger = logger
                )
            }

            // 4. ModuleInfo ì—…ë°ì´íŠ¸
            return moduleInfo.copy(
                version = versionInfo.version,
                status = "SUCCESS"
            )

        } catch (e: Exception) {
            // ì‹¤íŒ¨ ì‹œ fallback ë²„ì „ ì‚¬ìš©
            val fallbackVersion = VersionCalculationUtils.createFallbackVersion(moduleInfo.type)
            return moduleInfo.copy(
                version = fallbackVersion,
                status = "FAILED"
            )
        }
    }

    private fun calculateNextVersion(moduleInfo: ModuleInfo): VersionInfo {
        // 1. build.gradleì˜ í˜„ì¬ ë²„ì „ í™•ì¸
        val buildGradleVersion = ModuleVersionUtils.extractVersionFromBuildGradle(
            moduleName = moduleInfo.name,
            workspace = workspace,
            logger = logger
        )

        // 2. Git Tagì—ì„œ ìµœì‹  ë²„ì „ë“¤ í™•ì¸
        val latestReleaseVersion = GitTagUtils.getLatestReleaseVersion(...)     // v1.2.2
        val latestPreReleaseVersion = GitTagUtils.getLatestPreReleaseVersion(...) // v1.2.3-beta

        // 3. ë¸Œëœì¹˜ ì»¨í…ìŠ¤íŠ¸ ê²°ì •
        val branch = gitUtils.getCurrentBranch()
        val isMainBranch = branch.equals("main", ignoreCase = true)

        // 4. í†µí•© ë²„ì „ ê³„ì‚° ë¡œì§
        return VersionValidationUtils.calculateNextVersion(
            moduleInfo = moduleInfo,
            buildGradleVersion = buildGradleVersion,
            latestReleaseVersion = latestReleaseVersion,
            latestPreReleaseVersion = latestPreReleaseVersion,
            isMainBranch = isMainBranch,
            ...
        )
    }
}
```

**ë²„ì „ ê³„ì‚° ë¡œì§:**

```
â”Œâ”€ ë²„ì „ ê²°ì • íë¦„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚  1. ì •ë³´ ìˆ˜ì§‘                                                     â”‚
â”‚     â”œâ”€ build.gradle version: "1.2.0"                             â”‚
â”‚     â”œâ”€ ìµœì‹  ë¦´ë¦¬ìŠ¤ íƒœê·¸: fax-api/v1.2.2                           â”‚
â”‚     â””â”€ ìµœì‹  ê°œë°œ íƒœê·¸: fax-api/v1.2.3-beta.5                      â”‚
â”‚                                                                   â”‚
â”‚  2. ë¸Œëœì¹˜ í™•ì¸                                                   â”‚
â”‚     â””â”€ í˜„ì¬ ë¸Œëœì¹˜: develop                                       â”‚
â”‚                                                                   â”‚
â”‚  3. ë‹¤ìŒ ë²„ì „ ê³„ì‚°                                                â”‚
â”‚     â”œâ”€ main ë¸Œëœì¹˜: v1.2.3 (ë¦´ë¦¬ìŠ¤)                               â”‚
â”‚     â””â”€ ê¸°íƒ€ ë¸Œëœì¹˜: v1.2.3-beta.6 (í”„ë¦¬ë¦´ë¦¬ìŠ¤)                     â”‚
â”‚                                                                   â”‚
â”‚  4. Git íƒœê·¸ ìƒì„±                                                 â”‚
â”‚     â””â”€ git tag fax-api/v1.2.3-beta.6                             â”‚
â”‚     â””â”€ git push origin fax-api/v1.2.3-beta.6                     â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë²„ì „ ê·œì¹™:**

| ë¸Œëœì¹˜       | app ëª¨ë“ˆ      | lib ëª¨ë“ˆ          | íƒœê·¸ ì˜ˆì‹œ               |
|-----------|-------------|-----------------|---------------------|
| main      | v1.2.3      | v1.2.3          | fax-api/v1.2.3      |
| develop   | v1.2.3-beta | v1.2.3-SNAPSHOT | fax-api/v1.2.3-beta |
| feature/* | v1.2.3-beta | v1.2.3-SNAPSHOT | fax-api/v1.2.3-beta |

---

### 8.2 BuildExecutor - Docker ë¹Œë“œ

**íŒŒì¼**: `tasks/builder/executor/BuildExecutor.kt`

build.gradleì„ ìˆ˜ì •í•˜ê³  Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ì—¬ ECRì— í‘¸ì‹œí•œë‹¤.

```kotlin
class BuildExecutor(
    private val project: Project,
    private val logger: Logger,
    private val workspace: File
) {
    private val gitUtils = GitUtils(project, logger, workspace)
    private val appBuilderExtension = project.extensions.getByName(AppBuilderExtension.NAME)

    fun execute(moduleInfo: ModuleInfo): ModuleInfo {
        try {
            // 1. ModuleBuildContext ìƒì„±
            val buildContext = createBuildContext(moduleInfo)

            // 2. build.gradle ì—…ë°ì´íŠ¸
            performVersionIntegration(moduleInfo, buildContext)

            // 3. ì–¸ì–´ë³„ buildctl ëª…ë ¹ì–´ ìƒì„±
            val buildCommand = createBuildCommand(buildContext)

            // 4. buildctl ì‹¤í–‰ (ì‹¤ì‹œê°„ ë¡œê·¸ ì¶œë ¥)
            executeBuildCommand(buildCommand)

            // 5. ë¹Œë“œ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸
            return moduleInfo.copy(status = "SUCCESS")

        } catch (e: Exception) {
            throw e  // ìƒìœ„ì—ì„œ FAILED ì²˜ë¦¬
        }
    }
}
```

**BuildContext ìƒì„±:**

```kotlin
private fun createBuildContext(moduleInfo: ModuleInfo): ModuleBuildContext {
    // Dockerfile ê²½ë¡œ ë° ë¹Œë“œ ì •ë³´ ì¡°íšŒ
    val dockerfileBuildInfo = DockerfileBuildUtils.resolveBuildContext(
        module = moduleInfo.name,
        moduleType = moduleInfo.type,
        project = project,
        logger = logger
    )

    // ë¸Œëœì¹˜ì— ë”°ë¥¸ í™˜ê²½ ê°’ ê²°ì •
    val currentBranch = gitUtils.getCurrentBranch()
    val (nodeEnv, goEnv, springEnv) = determineEnvironmentByBranch(currentBranch)

    return ModuleBuildContext(
        module = moduleInfo.name,              // fax-api
        moduleType = moduleInfo.type,          // app
        tagVersion = moduleInfo.version,       // 1.2.3-beta
        dockerfilePath = dockerfileBuildInfo.path,  // Dockerfile.app.fax-api
        detectedLanguage = moduleInfo.language,     // JAVA
        ecrRegistry = "123456789.dkr.ecr.ap-northeast-2.amazonaws.com",
        gitRepoName = gitUtils.getRepoName(),  // fax
        branchName = currentBranch,            // develop
        nexusUsername = extension.nexus.username,
        nexusPassword = extension.nexus.password,
        nodeEnvironment = nodeEnv,             // dev
        goProfile = goEnv,                     // dev
        springProfilesActive = springEnv       // cloudconfig,test
    )
}
```

**ë¸Œëœì¹˜ë³„ í™˜ê²½ ì„¤ì •:**

| ë¸Œëœì¹˜       | NODE_ENV | GO_PROFILE | SPRING_PROFILES  |
|-----------|----------|------------|------------------|
| main      | prod     | prod       | cloudconfig,prod |
| develop   | dev      | dev        | cloudconfig,test |
| feature/* | dev      | dev        | cloudconfig,test |

**build.gradle ì—…ë°ì´íŠ¸:**

```kotlin
private fun performVersionIntegration(moduleInfo: ModuleInfo, buildContext: ModuleBuildContext) {
    // 1. ë²„ì „ ì—…ë°ì´íŠ¸
    // version = "1.0.0" â†’ version = "1.2.3-beta"
    ModuleVersionUtils.updateBuildGradleVersion(
        moduleInfo.name,
        buildContext.tagVersion,
        workspace,
        logger
    )

    // 2. ë¡œì»¬ ì˜ì¡´ì„± â†’ ì›ê²© ì˜ì¡´ì„± ë³€í™˜
    // implementation(project(":fax")) â†’ implementation("com.example:fax:1.2.3-SNAPSHOT")
    ModuleVersionUtils.convertLocalProjectToRemoteDependency(
        moduleInfo.name,
        workspace,
        logger
    )
}
```

**buildctl ëª…ë ¹ì–´ ì‹¤í–‰:**

```kotlin
private fun executeBuildCommand(command: String) {
    val processBuilder = ProcessBuilder("sh", "-c", command)
    processBuilder.directory(workspace)
    processBuilder.redirectErrorStream(true)

    val process = processBuilder.start()

    // ì‹¤ì‹œê°„ ë¡œê·¸ ì¶œë ¥
    process.inputStream.bufferedReader().use { reader ->
        reader.lineSequence().forEach { line ->
            println(formatLogLine(line))
        }
    }

    val exitCode = process.waitFor()
    if (exitCode != 0) {
        throw RuntimeException("ë¹Œë“œ ì‹¤íŒ¨ (ì¢…ë£Œ ì½”ë“œ: ${exitCode})")
    }
}
```

**ìƒì„±ë˜ëŠ” buildctl ëª…ë ¹ì–´ ì˜ˆì‹œ (JAVA):**

```bash
buildctl build \
  --frontend dockerfile.v0 \
  --local context=. \
  --local dockerfile=. \
  --opt filename=Dockerfile.app.fax-api \
  --opt build-arg:MODULE_NAME=fax-api \
  --opt build-arg:MODULE_VERSION=1.2.3-beta \
  --opt build-arg:NEXUS_USERNAME=admin \
  --opt build-arg:NEXUS_PASSWORD=*** \
  --opt build-arg:SPRING_PROFILES_ACTIVE=cloudconfig,test \
  --output type=image,name=123456789.dkr.ecr.ap-northeast-2.amazonaws.com/fax/fax-api:1.2.3-beta,push=true
```

---

### 8.3 HelmExecutor - Helm ì—…ë°ì´íŠ¸

**íŒŒì¼**: `tasks/builder/executor/HelmExecutor.kt`

ArgoCDê°€ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ Helm values ì €ì¥ì†Œì˜ image.tagë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.

```kotlin
class HelmExecutor(
    private val project: Project,
    private val logger: Logger,
    workspace: File
) {
    private val gitUtils = GitUtils(project, logger, workspace)
    private val extension = project.extensions.getByName(AppBuilderExtension.NAME)

    fun execute(moduleInfo: ModuleInfo): ModuleInfo {
        try {
            val version = moduleInfo.version
                ?: throw IllegalArgumentException("ëª¨ë“ˆ ë²„ì „ì´ ì—†ìŠµë‹ˆë‹¤")

            // 1. ì„ì‹œ ì‘ì—… ë””ë ‰í„°ë¦¬ ìƒì„±
            val workDir = project.layout.buildDirectory
                .dir("app-builder/helm-values").get().asFile
            workDir.deleteRecursively()
            workDir.mkdirs()

            try {
                // 2. Helm ì €ì¥ì†Œ í´ë¡ 
                cloneHelmRepo(workDir)

                // 3. YAML íŒŒì¼ì—ì„œ image.tag ì—…ë°ì´íŠ¸
                val updateSuccess = updateModuleValues(workDir, moduleInfo.name, version)

                if (updateSuccess) {
                    // 4. Git ì»¤ë°‹ ë° í‘¸ì‹œ (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
                    commitAndPushChanges(workDir, moduleInfo.name, version)
                }

                return moduleInfo.copy(status = "SUCCESS")

            } finally {
                // 5. ì„ì‹œ ë””ë ‰í„°ë¦¬ ì •ë¦¬
                workDir.deleteRecursively()
            }

        } catch (e: Exception) {
            throw e
        }
    }
}
```

**Helm ì €ì¥ì†Œ í´ë¡ :**

```kotlin
private fun cloneHelmRepo(workDir: File) {
    val helmRepo = extension.helmValuesRepo.orNull
        ?: throw IllegalArgumentException("Helm values ì €ì¥ì†Œ URLì´ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")

    val githubUsername = gitUtils.getGitHubUsername()
    val githubPassword = gitUtils.getGitHubPassword()

    // ì¸ì¦ ì •ë³´ë¥¼ URLì— í¬í•¨
    val authenticatedUrl = helmRepo.replace(
        "https://",
        "https://$githubUsername:$githubPassword@"
    )

    executeCommand("git clone -b main \"$authenticatedUrl\" .", workDir)
}
```

**YAML íŒŒì¼ íƒìƒ‰ ê²½ë¡œ:**

```kotlin
private fun updateModuleValues(workDir: File, moduleName: String, version: String): Boolean {
    val repoName = gitUtils.getRepoName()        // fax
    val currentBranch = gitUtils.getCurrentBranch()
    val environment = if (currentBranch == "main") "prod" else "dev"

    // ê°€ëŠ¥í•œ íŒŒì¼ ê²½ë¡œë“¤ (ìš°ì„ ìˆœìœ„ìˆœ)
    val possiblePaths = listOf(
        "$repoName/${environment}@$moduleName.yaml",  // fax/dev@fax-api.yaml
        "$repoName/${environment}/$moduleName.yaml",  // fax/dev/fax-api.yaml
        "${environment}@$moduleName.yaml",            // dev@fax-api.yaml
        "${environment}/$moduleName.yaml",            // dev/fax-api.yaml
        "$moduleName.yaml"                            // fax-api.yaml
    )

    for (path in possiblePaths) {
        val file = File(workDir, path)
        if (file.exists()) {
            return updateYamlFile(file, path, moduleName, version)
        }
    }

    return false  // íŒŒì¼ ì—†ìŒ
}
```

**YAML íŒŒì¼ ì—…ë°ì´íŠ¸:**

```kotlin
private fun updateYamlFile(file: File, path: String, moduleName: String, version: String): Boolean {
    val yaml = Yaml(DumperOptions().apply {
        defaultFlowStyle = DumperOptions.FlowStyle.BLOCK
        indent = 2
    })

    val values = yaml.load<Map<String, Any>>(file.readText())?.toMutableMap()
    val imageMap = (values["image"] as? Map<String, Any>)?.toMutableMap()

    val oldTag = imageMap["tag"]?.toString() ?: ""

    // ë²„ì „ì´ ê°™ìœ¼ë©´ ì—…ë°ì´íŠ¸ ë¶ˆí•„ìš”
    if (oldTag == version) return false

    // image.tag ì—…ë°ì´íŠ¸
    imageMap["tag"] = version
    values["image"] = imageMap

    file.writeText(yaml.dump(values))
    println("[$moduleName] íƒœê·¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ: $oldTag â†’ $version ($path)")
    return true
}
```

**Git í‘¸ì‹œ ì¬ì‹œë„ ë¡œì§:**

```kotlin
private fun commitAndPushChanges(workDir: File, moduleName: String, version: String) {
    // Git ì„¤ì •
    executeCommand("git config user.name \"${gitUtils.getGitAuthName()}\"", workDir)
    executeCommand("git config user.email \"${gitUtils.getGitAuthEmail()}\"", workDir)

    executeCommand("git add .", workDir)
    executeCommand("git commit -m \"${gitUtils.getCommitMessage()}\"", workDir)

    // Push with retry (ìµœëŒ€ 5íšŒ)
    var pushSuccess = false
    var retryCount = 0
    val maxRetries = 5

    while (!pushSuccess && retryCount < maxRetries) {
        try {
            if (retryCount == 0) {
                // 1ì°¨: ì¼ë°˜ push ì‹œë„
                executeCommand("git push origin HEAD:main", workDir)
            } else {
                // 2ì°¨~: fetch â†’ rebase â†’ push
                executeCommand("git fetch origin main", workDir)
                executeCommand("git rebase origin/main", workDir)
                executeCommand("git push origin HEAD:main", workDir)
            }
            pushSuccess = true

        } catch (e: Exception) {
            retryCount++
            if (retryCount >= maxRetries) {
                throw RuntimeException("Git push ì‹¤íŒ¨ - ë‹¤ë¥¸ ë³€ê²½ì‚¬í•­ê³¼ ì¶©ëŒ")
            }
            // ëŒ€ê¸° í›„ ì¬ì‹œë„ (2ì´ˆ, 4ì´ˆ, 6ì´ˆ...)
            Thread.sleep(retryCount * 2000L)
        }
    }
}
```

**ì¬ì‹œë„ íë¦„:**

```
â”Œâ”€ Git Push ì¬ì‹œë„ ë¡œì§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  1ì°¨ ì‹œë„: git push origin HEAD:main                            â”‚
â”‚      â”‚                                                           â”‚
â”‚      â”œâ”€ ì„±ê³µ â†’ ì™„ë£Œ                                              â”‚
â”‚      â”‚                                                           â”‚
â”‚      â””â”€ ì‹¤íŒ¨ (ë‹¤ë¥¸ íŒŒì´í”„ë¼ì¸ì´ ë¨¼ì € pushí•¨)                      â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  2ì°¨ ì‹œë„: git fetch â†’ git rebase â†’ git push                    â”‚
â”‚      â”‚                                                           â”‚
â”‚      â”œâ”€ ì„±ê³µ â†’ ì™„ë£Œ                                              â”‚
â”‚      â”‚                                                           â”‚
â”‚      â””â”€ ì‹¤íŒ¨ â†’ 2ì´ˆ ëŒ€ê¸°                                          â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  3ì°¨~5ì°¨: ë°˜ë³µ (4ì´ˆ, 6ì´ˆ, 8ì´ˆ ëŒ€ê¸°)                              â”‚
â”‚      â”‚                                                           â”‚
â”‚      â””â”€ 5íšŒ ëª¨ë‘ ì‹¤íŒ¨ â†’ ì˜ˆì™¸ ë°œìƒ                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì™œ ì¬ì‹œë„ê°€ í•„ìš”í•œê°€?**

```
â”Œâ”€ ë™ì‹œ ë¹Œë“œ ì‹œë‚˜ë¦¬ì˜¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  Pipeline A (fax-api)     Pipeline B (fax-batch)                â”‚
â”‚       â”‚                         â”‚                                â”‚
â”‚       â–¼                         â–¼                                â”‚
â”‚  Helm repo clone           Helm repo clone                      â”‚
â”‚       â”‚                         â”‚                                â”‚
â”‚       â–¼                         â–¼                                â”‚
â”‚  values ìˆ˜ì •               values ìˆ˜ì •                           â”‚
â”‚       â”‚                         â”‚                                â”‚
â”‚       â–¼                         â”‚                                â”‚
â”‚  git push âœ“                     â”‚                                â”‚
â”‚       â”‚                         â–¼                                â”‚
â”‚       â”‚                    git push âœ— (ì¶©ëŒ!)                    â”‚
â”‚       â”‚                         â”‚                                â”‚
â”‚       â”‚                         â–¼                                â”‚
â”‚       â”‚                    fetch â†’ rebase â†’ push âœ“               â”‚
â”‚       â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Helm ì—…ë°ì´íŠ¸ í›„ ArgoCD ìë™ ë°°í¬

```
â”Œâ”€ GitOps ë°°í¬ íë¦„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  1. HelmExecutorê°€ values.yaml ì—…ë°ì´íŠ¸                          â”‚
â”‚     â””â”€ image.tag: "1.2.2-beta" â†’ "1.2.3-beta"                   â”‚
â”‚                                                                  â”‚
â”‚  2. Git push â†’ Helm ì €ì¥ì†Œ ë³€ê²½                                  â”‚
â”‚                                                                  â”‚
â”‚  3. ArgoCDê°€ ì €ì¥ì†Œ ë³€ê²½ ê°ì§€ (Polling ë˜ëŠ” Webhook)             â”‚
â”‚                                                                  â”‚
â”‚  4. ArgoCDê°€ ìƒˆ ì´ë¯¸ì§€ë¡œ Kubernetes ë°°í¬                         â”‚
â”‚     â””â”€ kubectl set image deployment/fax-api ...                 â”‚
â”‚                                                                  â”‚
â”‚  5. Pod ë¡¤ë§ ì—…ë°ì´íŠ¸                                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. í•™ìŠµ ë¡œë“œë§µ

ì½”ë“œë¥¼ ê¹Šì´ ë³´ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ ìˆœì„œë¡œ í•™ìŠµí•˜ë©´ ëœë‹¤.

### ì¶”ì²œ í•™ìŠµ ìˆœì„œ

```
1ë‹¨ê³„: AppBuilderPlugin.kt (ì§„ì…ì , 30ì¤„)
         â†“
2ë‹¨ê³„: Entity í´ë” (ë°ì´í„° ëª¨ë¸ 3ê°œ)
         â†“
3ë‹¨ê³„: GetTargetsTask â†’ DetectorExecutor (ëª¨ë“ˆ ê°ì§€)
         â†“
4ë‹¨ê³„: AppBuilderTask â†’ AppBuilderExecutor (ë¹Œë“œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜)
         â†“
5ë‹¨ê³„: VersionExecutor, BuildExecutor, HelmExecutor (ì„¸ë¶€ ì‹¤í–‰ê¸°)
```

### í•µì‹¬ íŒŒì¼ ìœ„ì¹˜

```
app-builder-gradle-plugin/src/main/kotlin/com/example/plugins/gradle/
â”œâ”€â”€ AppBuilderPlugin.kt              # 1ë‹¨ê³„: ì§„ì…ì 
â”œâ”€â”€ entity/                          # 2ë‹¨ê³„: ë°ì´í„° ëª¨ë¸
â”‚   â”œâ”€â”€ BuildInfo.kt
â”‚   â”œâ”€â”€ ModuleInfo.kt
â”‚   â””â”€â”€ CommitInfo.kt
â”œâ”€â”€ extension/
â”‚   â””â”€â”€ AppBuilderExtension.kt       # ì „ì—­ ì„¤ì •
â”œâ”€â”€ tasks/
â”‚   â”œâ”€â”€ targets/
â”‚   â”‚   â”œâ”€â”€ GetTargetsTask.kt        # 3ë‹¨ê³„: ëª¨ë“ˆ ê°ì§€ íƒœìŠ¤í¬
â”‚   â”‚   â””â”€â”€ executor/
â”‚   â”‚       â””â”€â”€ DetectorExecutor.kt  # ëª¨ë“ˆ ê°ì§€ ë¡œì§
â”‚   â””â”€â”€ builder/
â”‚       â”œâ”€â”€ AppBuilderTask.kt        # 4ë‹¨ê³„: ë¹Œë“œ íƒœìŠ¤í¬
â”‚       â””â”€â”€ executor/
â”‚           â”œâ”€â”€ AppBuilderExecutor.kt # ë¹Œë“œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”‚           â”œâ”€â”€ VersionExecutor.kt    # 5ë‹¨ê³„: ë²„ì „ ê´€ë¦¬
â”‚           â”œâ”€â”€ BuildExecutor.kt      # Docker ë¹Œë“œ
â”‚           â””â”€â”€ HelmExecutor.kt       # Helm ì—…ë°ì´íŠ¸
```

---

## ë¶€ë¡: ì£¼ìš” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤

| í´ë˜ìŠ¤                       | ì—­í•                                |
|---------------------------|----------------------------------|
| `GitUtils`                | Git ëª…ë ¹ì–´ ì‹¤í–‰, ì»¤ë°‹ ì •ë³´ ìˆ˜ì§‘             |
| `ModuleDiscoveryUtils`    | settings.gradle íŒŒì‹±í•´ì„œ ëª¨ë“ˆ ëª©ë¡ ì¶”ì¶œ    |
| `DockerfileUtils`         | Dockerfile ì¡´ì¬ ì—¬ë¶€ë¡œ íƒ€ì…(app/lib) ê²°ì • |
| `LanguageDetectionUtils`  | Dockerfile/ë¹Œë“œíŒŒì¼ë¡œ ì–¸ì–´ ê°ì§€           |
| `DependencyAnalysisUtils` | Git diff + ì˜ì¡´ì„± ì „íŒŒë¡œ ë³€ê²½ ëª¨ë“ˆ ê°ì§€      |
| `VersionCalculationUtils` | Universal ë²„ì „ íŒŒì‹±/ë¹„êµ/ì¦ê°€            |
| `GitTagUtils`             | Git íƒœê·¸ì—ì„œ ë²„ì „ ì¶”ì¶œ                   |
| `ModuleVersionUtils`      | build.gradleì—ì„œ ë²„ì „ ì¶”ì¶œ/ì—…ë°ì´íŠ¸        |
| `BuildCommandGenerator`   | ì–¸ì–´ë³„ buildctl ëª…ë ¹ì–´ ìƒì„±              |
| `JsonUtil`                | BuildInfoë¥¼ JSONìœ¼ë¡œ ì½ê¸°/ì“°ê¸°          |

---

## 10. ì „ì²´ íë¦„ ìš”ì•½

ê°œë°œìê°€ ì½”ë“œë¥¼ í‘¸ì‹œí•˜ë©´ ë°°í¬ê¹Œì§€ ì–´ë–»ê²Œ ì§„í–‰ë˜ëŠ”ì§€ í•œëˆˆì— ë³´ëŠ” íë¦„ì´ë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  ğŸ‘¨â€ğŸ’» ê°œë°œì: git push origin develop                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”” GitHub Webhook â†’ Jenkins ë¹Œë“œ íŠ¸ë¦¬ê±°                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ Jenkinsfile ì‹¤í–‰                                                        â”‚
â”‚                                                                             â”‚
â”‚     @Library('app-builder-gradle-plugin-pipeline') _                        â”‚
â”‚     build()                                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Stage: ë³€ê²½ ê°ì§€                                                        â”‚
â”‚                                                                             â”‚
â”‚     gradle GetTargets                                                       â”‚
â”‚       â”œâ”€ git diffë¡œ ë³€ê²½ëœ íŒŒì¼ í™•ì¸                                        â”‚
â”‚       â”œâ”€ ë³€ê²½ëœ ëª¨ë“ˆ + ì˜ì¡´ ëª¨ë“ˆ ì°¾ê¸°                                        â”‚
â”‚       â””â”€ modules-data.json ìƒì„±                                             â”‚
â”‚                                                                             â”‚
â”‚     ê²°ê³¼: fax-common(ë³€ê²½ë¨), fax-api(ì˜ì¡´), fax-batch(ë³€ê²½ì—†ìŒâ†’ìŠ¤í‚µ)        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¨ Stage: [JAVA] fax-common (lib)                                          â”‚
â”‚                                                                             â”‚
â”‚     gradle AppBuilder -PtargetModule=fax-common                             â”‚
â”‚       â”œâ”€ ë²„ì „ ê³„ì‚°: 1.0.5-SNAPSHOT                                          â”‚
â”‚       â”œâ”€ Git íƒœê·¸: fax-common/v1.0.5-SNAPSHOT                               â”‚
â”‚       â”œâ”€ Docker ë¹Œë“œ â†’ Nexusì— jar ë°°í¬                                     â”‚
â”‚       â””â”€ (libëŠ” Helm ìŠ¤í‚µ)                                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¨ Stage: [JAVA] fax-api (app)                                             â”‚
â”‚                                                                             â”‚
â”‚     gradle AppBuilder -PtargetModule=fax-api                                â”‚
â”‚       â”œâ”€ ë²„ì „ ê³„ì‚°: 2.1.0-beta                                              â”‚
â”‚       â”œâ”€ Git íƒœê·¸: fax-api/v2.1.0-beta                                      â”‚
â”‚       â”œâ”€ Docker ë¹Œë“œ â†’ ECRì— ì´ë¯¸ì§€ í‘¸ì‹œ                                    â”‚
â”‚       â””â”€ Helm values.yaml ì—…ë°ì´íŠ¸ (image.tag: 2.1.0-beta)                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â­ï¸ Stage: [JAVA] fax-batch â†’ SKIPPED (ë³€ê²½ ì—†ìŒ)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Jenkins ë¹Œë“œ ì™„ë£Œ                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš€ ArgoCDê°€ Helm ì €ì¥ì†Œ ë³€ê²½ ê°ì§€                                           â”‚
â”‚                                                                             â”‚
â”‚     â†’ Kubernetesì— fax-api:2.1.0-beta ë°°í¬                                  â”‚
â”‚     â†’ Pod ë¡¤ë§ ì—…ë°ì´íŠ¸                                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  ğŸ‰ ë°°í¬ ì™„ë£Œ!                                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

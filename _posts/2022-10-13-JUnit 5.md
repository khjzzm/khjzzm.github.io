---
layout: post
title: JUnit 5
---

2.2+ 버전의 스프링 부트 프로젝트를 만든다면 기본으로 JUnit 5 의존성 추가 됨.


## 테스트 이름 표시하기

~~~java
@DisplayNameGeneration(DisplayNameGenerator.ReplaceUnderscores.class)
~~~
- Method와 Class 레퍼런스를 사용해서 테스트 이름을 표기하는 방법 설정.
- 기본 구현체로 ReplaceUnderscores 제공


-----

~~~java
@DisplayName("스터디 만들기")
~~~
- 어떤 테스트인지 테스트 이름을 보다 쉽게 표현할 수 있는 방법을 제공하는 애노테이션.
- @DisplayNameGeneration 보다 우선 순위가 높다.

-----


## Assertion
org.junit.jupiter.api.Assertions.*

~~~java
@Test
@DisplayName("스터디 만들기")
void create_new_study() {
    Study study = new Study(5);

    assertNotNull(study);
    // messages 를 람다식으로 작성하는 이유는?
    assertEquals(StudyStatus.DRAFT, study.getStatus(), () -> "스터디를 처음 만들면" + StudyStatus.DRAFT + "여야 한다.");
    assertTrue(study.getLimit() > 0, () -> "스터디 최대 참석 인원은 0 보다 커야 한다.");
    IllegalArgumentException exception = assertThrows(IllegalArgumentException.class, () -> new Study(-10));
    assertEquals("limit 은 0보다 커야 한다.", exception.getMessage());

    assertTimeout(Duration.ofMillis(100), ()-> {
        new Study(10);
        Thread.sleep(50);
    });

    assertTimeoutPreemptively(Duration.ofMillis(100), ()-> {
        new Study(10);
        Thread.sleep(50);
    });

    assertAll(
            () -> assertNotNull(study),
            () -> assertEquals(StudyStatus.DRAFT, study.getStatus(), () -> "스터디를 처음 만들면" + StudyStatus.DRAFT + "여야 한다."),
            () -> assertTrue(study.getLimit() > 0, () -> "스터디 최대 참석 인원은 0 보다 커야 한다."),
            () -> assertThrows(IllegalArgumentException.class, () -> new Study(-10))
    );

}
~~~

실제 값이 기대한 값과 같은지 확인 | assertEqulas(expected, actual)   
값이 null이 아닌지 확인 | assertNotNull(actual)   
다음 조건이 참(true)인지 확인 | assertTrue(boolean)    
모든 확인 구문 확인 | assertAll(executables...)    
예외 발생 확인 | assertThrows(expectedType, executable)   
특정 시간 안에 실행이 완료되는지 확인 | assertTimeout(duration, executable)   


마지막 매개변수로 Supplier<String> 타입의 인스턴스를 람다 형태로 제공할 수 있다.
- 복잡한 메시지 생성해야 하는 경우 사용하면 실패한 경우에만 해당 메시지를 만들게 할 수 있다.

## 조건에 따라 테스트 실행하기

~~~java
@Test
@DisplayName("조건에 따라 테스트 실행하기")
void create_con_study() {
    String test_env = System.getenv("TEST_ENV");
    System.out.println("TEST_ENV:" + test_env);
    assumeTrue("LOCAL".equalsIgnoreCase(test_env));

    assumingThat("LOCAL".equalsIgnoreCase(test_env), ()->{
        System.out.println("local");
        Study actual = new Study(100);
        assertThat(actual.getLimit()).isGreaterThan(0);
    });
}


@Test
@DisplayName("조건에 따라 테스트 실행하기 annotation")
@EnabledOnOs({OS.MAC, OS.LINUX})
@EnabledOnJre(JRE.JAVA_8)
//    @DisabledOnOs(OS.MAC)
@EnabledIfEnvironmentVariable(named = "TEST_ENV", matches = "LOCAL")
void create_con1_study() {
    String test_env = System.getenv("TEST_ENV");
    System.out.println("TEST_ENV:" + test_env);
    assumeTrue("LOCAL".equalsIgnoreCase(test_env));
}
~~~